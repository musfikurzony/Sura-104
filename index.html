<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <title>Al-Qur'an тАв Word by Word + ржмрж╛ржВрж▓рж╛</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Tailwind CDN (simple) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Simple base styles -->
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    .arabic-text {
      font-size: 1.7rem;
      line-height: 2.2rem;
      direction: rtl;
      text-align: right;
    }
    .word-tile {
      border-radius: 0.75rem;
      padding: 0.5rem 0.75rem;
      margin: 0.35rem;
      border: 1px solid rgba(148, 163, 184, 0.6);
      cursor: pointer;
      transition: transform 0.1s ease, box-shadow 0.1s ease, background-color 0.15s ease;
      background: linear-gradient(to bottom right, #ffffff, #f8fafc);
    }
    .word-tile:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 14px rgba(15, 23, 42, 0.12);
      background: linear-gradient(to bottom right, #eff6ff, #f9fafb);
    }
    .tab-btn-active {
      background-color: #0f172a;
      color: #e5e7eb;
    }
    .tab-btn-inactive {
      background-color: #e5e7eb;
      color: #111827;
    }
  </style>
</head>
<body class="bg-slate-100 text-slate-900 min-h-screen">

  <!-- App Shell -->
  <div class="max-w-5xl mx-auto px-4 py-4 sm:py-6">

    <!-- Header -->
    <header class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 mb-5">
      <div>
        <h1 class="text-2xl sm:text-3xl font-bold tracking-tight">
          AL-QUR'AN
        </h1>
        <p class="text-sm text-slate-500">
          Word-by-Word тАв ржмрж╛ржВрж▓рж╛ рж╕рж╣
        </p>
      </div>

      <!-- Top Right Actions -->
      <div class="flex items-center gap-2">
        <!-- Settings button (only opens panel, no extra UI clutter on home) -->
        <button id="settingsToggle"
          class="inline-flex items-center gap-1 px-3 py-2 rounded-xl border border-slate-300 bg-white text-sm shadow-sm hover:bg-slate-50">
          <span>тЪЩя╕П</span> <span>рж╕рзЗржЯрж┐ржВ & ржнрж┐ржЙ</span>
        </button>

        <!-- Surah list button -->
        <button id="surahListToggle"
          class="inline-flex items-center gap-1 px-3 py-2 rounded-xl border border-slate-300 bg-white text-sm shadow-sm hover:bg-slate-50">
          <span>ЁЯУЪ</span> <span>рж╕рзВрж░рж╛ рждрж╛рж▓рж┐ржХрж╛</span>
        </button>
      </div>
    </header>

    <!-- Settings panel (collapsible) -->
    <section id="settingsPanel" class="hidden mb-4">
      <div class="bg-white rounded-2xl shadow border border-slate-200 p-4 grid gap-3 sm:grid-cols-2">
        <div>
          <h2 class="font-semibold mb-2">ЁЯФд Arabic Font Size</h2>
          <input id="fontSizeRange" type="range" min="18" max="32" value="24" class="w-full" />
        </div>
        <div>
          <h2 class="font-semibold mb-2">ЁЯУЦ ржнрж┐ржЙ ржорзЛржб</h2>
          <p class="text-xs text-slate-500">ржПржЗ рж╕рзЗржЯрж┐ржВ ржнржмрж┐рж╖рзНржпрждрзЗ ржЖрж░ржУ ржмрж╛рзЬрж╛ржирзЛ ржпрж╛ржмрзЗ (dark mode, line height ржЗрждрзНржпрж╛ржжрж┐)ред</p>
        </div>
      </div>
    </section>

    <!-- Surah list panel (collapsible) -->
    <section id="surahListPanel" class="hidden mb-4">
      <div class="bg-white rounded-2xl shadow border border-slate-200 p-4">
        <h2 class="font-semibold mb-3 flex items-center gap-2">
          ЁЯУЪ  рж╕рзВрж░рж╛рж░ рждрж╛рж▓рж┐ржХрж╛
        </h2>
        <p class="text-xs text-slate-500 mb-3">
          рззтАУрззрззрзк ржкрж░рзНржпржирзНржд рж╕ржм рж╕рзВрж░рж╛ тАФ ржпрзЗ рж╕рзВрж░рж╛рж░ JSON data ржпрзБржХрзНржд рж╣ржмрзЗ, рж╕рзЗржЯрж┐ ржкрзЬрж╛ ржпрж╛ржмрзЗред
        </p>

        <div class="flex flex-col sm:flex-row gap-3 items-start sm:items-center mb-3">
          <label for="surahSelect" class="text-sm font-medium">
            рж╕рзВрж░рж╛ ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзБржи
          </label>
          <select id="surahSelect"
            class="w-full sm:w-auto min-w-[240px] px-3 py-2 rounded-xl border border-slate-300 bg-white text-sm shadow-sm">
            <option value="">тАФ рж╕рзВрж░рж╛ рждрж╛рж▓рж┐ржХрж╛ ржерзЗржХрзЗ ржПржХржЯрж┐ ржмрзЗржЫрзЗ ржирж┐ржи</option>
          </select>
        </div>
      </div>
    </section>

    <!-- Main Content Card -->
    <main id="mainCard" class="bg-white rounded-3xl shadow-lg border border-slate-200 p-4 sm:p-6">

      <!-- Empty state (when no surah selected) -->
      <section id="emptyState">
        <div class="text-center py-10">
          <div class="text-4xl mb-3">ЁЯУЦ</div>
          <h2 class="text-lg font-semibold mb-1">рж╕рзВрж░рж╛ ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзБржи</h2>
          <p class="text-sm text-slate-500 mb-4">
            ржЙржкрж░рзЗрж░ <strong>ЁЯУЪ рж╕рзВрж░рж╛ рждрж╛рж▓рж┐ржХрж╛</strong> ржмрж╛ржЯржирзЗ ржХрзНрж▓рж┐ржХ ржХрж░рзЗ ржПржХржЯрж┐ рж╕рзВрж░рж╛ ржмрзЗржЫрзЗ ржирж┐ржиред
          </p>
        </div>
      </section>

      <!-- Surah Content (hidden until a surah is selected) -->
      <section id="surahContent" class="hidden">

        <!-- Surah Header -->
        <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-2 mb-4">
          <div>
            <p id="surahBasicInfo" class="text-xs uppercase tracking-wide text-slate-400">
              <!-- e.g. Sura 103 тАв Makki тАв 3 Ayat -->
            </p>
            <h2 id="surahNameBn" class="text-xl sm:text-2xl font-bold"></h2>
            <p id="surahNameAr" class="text-lg text-emerald-700 mt-1"></p>
          </div>

          <!-- тАЬBack to HomeтАЭ -->
          <button id="backHomeBtn"
            class="inline-flex items-center gap-1 px-3 py-2 rounded-xl border border-slate-300 bg-slate-50 text-xs sm:text-sm hover:bg-slate-100">
            тмЕя╕П рж╣рзЛржорзЗ ржлрж┐рж░рзЗ ржпрж╛ржи
          </button>
        </div>

        <!-- Tabs -->
        <div class="flex gap-2 mb-4">
          <button id="tabWordByWord"
            class="flex-1 px-3 py-2 text-sm font-medium rounded-xl tab-btn-active">
            ЁЯФН рж╢ржмрзНржжрзЗтАУрж╢ржмрзНржжрзЗ
          </button>
          <button id="tabTranslations"
            class="flex-1 px-3 py-2 text-sm font-medium rounded-xl tab-btn-inactive">
            ЁЯУЪ ржЕржирзБржмрж╛ржж
          </button>
        </div>

        <!-- Multi-translator selection for translation tab -->
        <div id="translatorOptions" class="hidden mb-3">
          <p class="text-xs text-slate-500 mb-1">ржпрзЗрж╕ржм ржЕржирзБржмрж╛ржжржХ ржжрзЗржЦрждрзЗ ржЪрж╛ржУ, рж╕рзЗржЧрзБрж▓рзЛ рж╕рж┐рж▓рзЗржХрзНржЯ ржХрж░рзЛ (ржПржХрж╛ржзрж┐ржХ рж╕рж┐рж▓рзЗржХрзНржЯ ржХрж░рж╛ ржпрж╛ржмрзЗ):</p>
          <div class="flex flex-wrap gap-3 text-sm">
            <label class="inline-flex items-center gap-1">
              <input type="checkbox" id="translatorOsmani" checked />
              <span>рждрж╛ржлрж╕рзАрж░рзЗ ржУрж╕ржорж╛ржирзА</span>
            </label>
            <label class="inline-flex items-center gap-1">
              <input type="checkbox" id="translatorTawjih" checked />
              <span>рждрж╛ржУржпрзАрж╣рзБрж▓ ржХрзБрж░ржЖржи</span>
            </label>
          </div>
        </div>

        <!-- Word-by-word view -->
        <div id="wordByWordView">
          <!-- JS will insert ayat blocks here -->
        </div>

        <!-- Translation view -->
        <div id="translationsView" class="hidden">
          <!-- JS will insert translations here -->
        </div>

      </section>
    </main>
  </div>

  <!-- Load suras list -->
  <script src="suras.js"></script>

  <script>
    // ========= ELEMENTS =========
    const settingsToggle = document.getElementById('settingsToggle');
    const surahListToggle = document.getElementById('surahListToggle');
    const settingsPanel = document.getElementById('settingsPanel');
    const surahListPanel = document.getElementById('surahListPanel');
    const surahSelect = document.getElementById('surahSelect');

    const emptyState = document.getElementById('emptyState');
    const surahContent = document.getElementById('surahContent');
    const surahNameBn = document.getElementById('surahNameBn');
    const surahNameAr = document.getElementById('surahNameAr');
    const surahBasicInfo = document.getElementById('surahBasicInfo');

    const backHomeBtn = document.getElementById('backHomeBtn');

    const tabWordByWord = document.getElementById('tabWordByWord');
    const tabTranslations = document.getElementById('tabTranslations');
    const wordByWordView = document.getElementById('wordByWordView');
    const translationsView = document.getElementById('translationsView');

    const translatorOptions = document.getElementById('translatorOptions');
    const translatorOsmani = document.getElementById('translatorOsmani');
    const translatorTawjih = document.getElementById('translatorTawjih');

    const fontSizeRange = document.getElementById('fontSizeRange');

    let currentSurah = null;
    let currentSurahData = null;

    // ========= HELPERS =========

    function toggleVisibility(el) {
      if (!el) return;
      el.classList.toggle('hidden');
    }

    function setTab(active) {
      if (active === 'word') {
        tabWordByWord.classList.add('tab-btn-active');
        tabWordByWord.classList.remove('tab-btn-inactive');
        tabTranslations.classList.add('tab-btn-inactive');
        tabTranslations.classList.remove('tab-btn-active');

        wordByWordView.classList.remove('hidden');
        translationsView.classList.add('hidden');
        translatorOptions.classList.add('hidden');
      } else {
        tabTranslations.classList.add('tab-btn-active');
        tabTranslations.classList.remove('tab-btn-inactive');
        tabWordByWord.classList.add('tab-btn-inactive');
        tabWordByWord.classList.remove('tab-btn-active');

        wordByWordView.classList.add('hidden');
        translationsView.classList.remove('hidden');
        translatorOptions.classList.remove('hidden');
      }
    }

    function applyFontSize(sizePx) {
      const arabicNodes = document.querySelectorAll('.arabic-text');
      arabicNodes.forEach(node => {
        node.style.fontSize = sizePx + 'px';
      });
    }

    fontSizeRange.addEventListener('input', (e) => {
      applyFontSize(e.target.value);
    });

    // ========= LOAD SURAS LIST =========
    function populateSurahDropdown() {
      try {
        if (!window.suras || !Array.isArray(window.suras)) {
          console.error('suras.js not loaded or malformed');
          return;
        }

        // Clear existing options except first
        while (surahSelect.options.length > 1) {
          surahSelect.remove(1);
        }

        window.suras.forEach(s => {
          const opt = document.createElement('option');
          opt.value = s.number;
          opt.textContent = `${s.number}. ${s.nameBn}`;
          surahSelect.appendChild(opt);
        });

      } catch (err) {
        console.error('Error populating surah dropdown', err);
      }
    }

    // ========= RENDER FUNCTIONS =========

    function renderSurahHeader(meta, data) {
      surahNameBn.textContent = meta.nameBn || data.nameBn || '';
      surahNameAr.textContent = meta.nameAr || data.nameAr || '';
      const place = data.revelationPlace || meta.type || '';
      const ayCount = data.ayahCount || meta.ayahCount || (data.ayahs ? data.ayahs.length : '');
      surahBasicInfo.textContent = `Sura ${meta.number || data.number} тАв ${place} тАв ${ayCount} Ayat`;
    }

    function renderWordByWord(data) {
      wordByWordView.innerHTML = '';

      if (data.hasBismillah && data.bismillah && data.bismillah.arabic) {
        const bBlock = document.createElement('div');
        bBlock.className = 'mb-4 border-b border-dashed border-slate-200 pb-4';

        const arEl = document.createElement('div');
        arEl.className = 'arabic-text font-semibold mb-2';
        arEl.textContent = data.bismillah.arabic;
        bBlock.appendChild(arEl);

        if (data.bismillah.bangla) {
          const bnEl = document.createElement('p');
          bnEl.className = 'text-sm text-slate-600';
          bnEl.textContent = data.bismillah.bangla;
          bBlock.appendChild(bnEl);
        }

        wordByWordView.appendChild(bBlock);
      }

      if (!Array.isArray(data.ayahs)) return;

      data.ayahs.forEach(ayah => {
        const ayBlock = document.createElement('div');
        ayBlock.className = 'mb-4 rounded-2xl border border-slate-200 p-3 bg-slate-50/60';

        const header = document.createElement('div');
        header.className = 'flex items-center justify-between mb-2';

        const left = document.createElement('div');
        left.className = 'text-xs text-slate-500';
        left.textContent = `ржЖрзЯрж╛ржд ${ayah.ayahNumber}`;
        header.appendChild(left);

        ayBlock.appendChild(header);

        const arEl = document.createElement('div');
        arEl.className = 'arabic-text font-semibold mb-1';
        arEl.textContent = ayah.arabic;
        ayBlock.appendChild(arEl);

        if (ayah.bangla) {
          const bnEl = document.createElement('p');
          bnEl.className = 'text-sm text-slate-600 mb-2';
          bnEl.textContent = ayah.bangla;
          ayBlock.appendChild(bnEl);
        }

        const wordsWrap = document.createElement('div');
        wordsWrap.className = 'flex flex-wrap mt-1';
        if (Array.isArray(ayah.words)) {
          ayah.words.forEach(w => {
            const tile = document.createElement('button');
            tile.type = 'button';
            tile.className = 'word-tile text-xs text-left';

            const wText = document.createElement('div');
            wText.className = 'font-semibold arabic-text text-base leading-6 mb-1';
            wText.textContent = w.text || '';

            const wMean = document.createElement('div');
            wMean.className = 'text-[11px] text-slate-600';
            wMean.textContent = w.meaningBn || '';

            tile.appendChild(wText);
            tile.appendChild(wMean);

            if (w.notes) {
              tile.title = w.notes;
            }

            wordsWrap.appendChild(tile);
          });
        }

        ayBlock.appendChild(wordsWrap);
        wordByWordView.appendChild(ayBlock);
      });

      applyFontSize(fontSizeRange.value);
    }

    function renderTranslationsView(data) {
      translationsView.innerHTML = '';

      const selected = [];
      if (translatorOsmani.checked && data.translations && data.translations.osmani) {
        selected.push(data.translations.osmani);
      }
      if (translatorTawjih.checked && data.translations && data.translations.tawjih) {
        selected.push(data.translations.tawjih);
      }

      if (selected.length === 0) {
        const msg = document.createElement('p');
        msg.className = 'text-sm text-slate-500';
        msg.textContent = 'ржХржоржкржХрзНрж╖рзЗ ржПржХржЬржи ржЕржирзБржмрж╛ржжржХ рж╕рж┐рж▓рзЗржХрзНржЯ ржХрж░рзБржиред';
        translationsView.appendChild(msg);
        return;
      }

      // For each ayah, show all selected translators
      if (!Array.isArray(data.ayahs)) return;

      data.ayahs.forEach(ayah => {
        const block = document.createElement('div');
        block.className = 'mb-4 rounded-2xl border border-slate-200 p-3 bg-slate-50/60';

        const header = document.createElement('div');
        header.className = 'flex items-center justify-between mb-2';

        const left = document.createElement('div');
        left.className = 'text-xs text-slate-500';
        left.textContent = `ржЖрзЯрж╛ржд ${ayah.ayahNumber}`;
        header.appendChild(left);

        block.appendChild(header);

        const arEl = document.createElement('div');
        arEl.className = 'arabic-text font-semibold mb-2';
        arEl.textContent = ayah.arabic;
        block.appendChild(arEl);

        // For each translator, find text of this ayah
        selected.forEach(tr => {
          const row = document.createElement('div');
          row.className = 'mb-2';

          const label = document.createElement('p');
          label.className = 'text-xs font-semibold text-slate-500';
          label.textContent = tr.label || tr.id || 'ржЕржирзБржмрж╛ржж';
          row.appendChild(label);

          const ayTextObj = Array.isArray(tr.ayahs)
            ? tr.ayahs.find(a => a.ayahNumber === ay.ayahNumber)
            : null;

          const tText = document.createElement('p');
          tText.className = 'text-sm text-slate-700';
          tText.textContent = ayTextObj ? ayTextObj.text : 'тАФ';
          row.appendChild(tText);

          block.appendChild(row);
        });

        translationsView.appendChild(block);
      });
    }

    // ========= LOAD SURAH JSON =========
    async function loadSurahData(surahMeta) {
      if (!surahMeta.file) {
        alert('ржПржЗ рж╕рзВрж░рж╛рж░ ржЬржирзНржп ржХрзЛржирзЛ JSON ржлрж╛ржЗрж▓ рж╕рзЗржЯ ржХрж░рж╛ ржирзЗржЗ (suras.js ржЪрзЗржХ ржХрж░рзБржи)ред');
        return;
      }

      try {
        const res = await fetch(surahMeta.file);
        if (!res.ok) {
          throw new Error('HTTP ' + res.status);
        }
        const data = await res.json();
        currentSurahData = data;

        // Show content
        emptyState.classList.add('hidden');
        surahContent.classList.remove('hidden');

        renderSurahHeader(surahMeta, data);
        renderWordByWord(data);
        renderTranslationsView(data);
        setTab('word');
      } catch (err) {
        console.error('Failed to load surah JSON:', err);
        alert('ржПржЗ рж╕рзВрж░рж╛рж░ JSON ржбрж╛ржЯрж╛ рж▓рзЛржб ржХрж░рждрзЗ рж╕ржорж╕рзНржпрж╛ рж╣ржЪрзНржЫрзЗред ржлрж╛ржЗрж▓рзЗрж░ ржирж╛ржо ржПржмржВ ржлрж░ржорзНржпрж╛ржЯ ржЖржмрж╛рж░ ржЪрзЗржХ ржХрж░рзБржиред');
      }
    }

    // ========= EVENT LISTENERS =========

    settingsToggle.addEventListener('click', () => {
      toggleVisibility(settingsPanel);
    });

    surahListToggle.addEventListener('click', () => {
      toggleVisibility(surahListPanel);
    });

    backHomeBtn.addEventListener('click', () => {
      currentSurah = null;
      currentSurahData = null;
      surahSelect.value = '';
      surahContent.classList.add('hidden');
      emptyState.classList.remove('hidden');
    });

    tabWordByWord.addEventListener('click', () => {
      setTab('word');
    });

    tabTranslations.addEventListener('click', () => {
      setTab('translation');
      if (currentSurahData) {
        renderTranslationsView(currentSurahData);
      }
    });

    translatorOsmani.addEventListener('change', () => {
      if (currentSurahData && !translationsView.classList.contains('hidden')) {
        renderTranslationsView(currentSurahData);
      }
    });

    translatorTawjih.addEventListener('change', () => {
      if (currentSurahData && !translationsView.classList.contains('hidden')) {
        renderTranslationsView(currentSurahData);
      }
    });

    surahSelect.addEventListener('change', (e) => {
      const num = parseInt(e.target.value, 10);
      if (!num) {
        return;
      }
      if (!window.suras) return;
      const meta = window.suras.find(s => s.number === num);
      if (!meta) {
        alert('ржПржЗ рж╕рзВрж░рж╛ ржирж╛ржо suras.js ржП ржкрж╛ржУрзЯрж╛ ржпрж╛рзЯржирж┐ред');
        return;
      }
      currentSurah = meta;
      loadSurahData(meta);
    });

    // ========= INIT =========
    document.addEventListener('DOMContentLoaded', () => {
      populateSurahDropdown();
    });
  </script>
</body>
</html>
