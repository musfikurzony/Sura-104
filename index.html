<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <title>Qur'an Word-by-Word (Bangla)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      margin: 0;
      font-family: "Noto Sans Bengali", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #0f172a;
      color: #e5e7eb;
    }

    .app-shell {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      padding: 0.75rem 1rem;
      background: linear-gradient(to right, #020617, #0f172a);
      border-bottom: 1px solid rgba(148, 163, 184, 0.4);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    header h1 {
      font-size: 1rem;
      margin: 0;
      font-weight: 600;
      letter-spacing: 0.03em;
      color: #e2e8f0;
    }

    .header-sub {
      font-size: 0.75rem;
      color: #94a3b8;
    }

    .header-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      align-items: center;
    }

    select, button {
      font: inherit;
    }

    .select, .btn {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      background: rgba(15, 23, 42, 0.7);
      color: #e5e7eb;
      padding: 0.35rem 0.75rem;
      font-size: 0.8rem;
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      cursor: pointer;
    }

    .select select {
      border: none;
      outline: none;
      background: transparent;
      color: inherit;
      font: inherit;
    }

    .btn {
      transition: background 0.2s, transform 0.1s, border-color 0.2s;
    }

    .btn:hover {
      background: rgba(30, 64, 175, 0.7);
      border-color: rgba(129, 140, 248, 0.9);
    }

    .btn.active {
      background: linear-gradient(to right, #1d4ed8, #7c3aed);
      border-color: transparent;
    }

    main {
      flex: 1;
      display: grid;
      grid-template-columns: minmax(0, 2.2fr) minmax(260px, 1.4fr);
      gap: 0.75rem;
      padding: 0.75rem;
    }

    @media (max-width: 900px) {
      main {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    /* LEFT SIDE: Arabic + Word by Word */
    .panel {
      border-radius: 1rem;
      background: radial-gradient(circle at top left, rgba(30, 64, 175, 0.18), transparent 55%),
                  radial-gradient(circle at bottom right, rgba(76, 29, 149, 0.16), transparent 60%),
                  rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.5);
      padding: 0.75rem;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .panel-title {
      font-size: 0.9rem;
      font-weight: 600;
      color: #e2e8f0;
    }

    .panel-subtitle {
      font-size: 0.7rem;
      color: #94a3b8;
    }

    .mode-toggle {
      display: inline-flex;
      padding: 0.15rem;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.8);
      border: 1px solid rgba(148, 163, 184, 0.6);
    }

    .mode-toggle button {
      border: none;
      background: transparent;
      padding: 0.25rem 0.5rem;
      border-radius: 999px;
      font-size: 0.7rem;
      color: #9ca3af;
      cursor: pointer;
      transition: all 0.15s;
      white-space: nowrap;
    }

    .mode-toggle button.active {
      background: rgba(59, 130, 246, 0.15);
      color: #e5e7eb;
      box-shadow: 0 0 0 1px rgba(129, 140, 248, 0.5);
    }

    .ayah {
      position: relative;
      padding: 0.6rem 0.55rem;
      border-radius: 0.85rem;
      border: 1px solid rgba(51, 65, 85, 0.8);
      background: linear-gradient(to right, rgba(15, 23, 42, 0.95), rgba(15, 23, 42, 0.7));
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.7);
    }

    .ayah-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.5rem;
      margin-bottom: 0.35rem;
    }

    .ayah-number {
      font-size: 0.7rem;
      padding: 0.05rem 0.45rem;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      color: #cbd5f5;
      background: rgba(15, 23, 42, 0.8);
    }

    .ayah-meta {
      font-size: 0.65rem;
      color: #94a3b8;
      text-align: right;
    }

    .ayah-arabic {
      font-family: "Scheherazade New", "Amiri", "Noto Naskh Arabic", serif;
      direction: rtl;
      text-align: right;
      font-size: var(--arabic-font-size, 1.3rem);
      line-height: 2.1;
      margin-bottom: 0.3rem;
      cursor: default;
      user-select: none;
    }

    .word-token {
      display: inline-block;
      padding: 0.1rem 0.3rem;
      margin: 0.05rem 0.12rem;
      border-radius: 0.6rem;
      transition: background 0.15s, transform 0.05s, box-shadow 0.15s;
      cursor: pointer;
    }

    .word-token:hover {
      background: rgba(37, 99, 235, 0.3);
      box-shadow: 0 0 0 1px rgba(129, 140, 248, 0.8);
      transform: translateY(-1px);
    }

    .word-token.active {
      background: linear-gradient(to left, rgba(37, 99, 235, 0.4), rgba(109, 40, 217, 0.45));
      box-shadow: 0 0 0 1px rgba(244, 244, 245, 0.9);
    }

    .ayah-bn-translation {
      font-size: var(--bangla-font-size, 0.9rem);
      line-height: 1.6;
      color: #e5e7eb;
      margin-top: 0.25rem;
      border-top: 1px solid rgba(51, 65, 85, 0.9);
      padding-top: 0.25rem;
    }

    .ayah-bn-translation .label {
      font-size: 0.7rem;
      color: #9ca3af;
      margin-bottom: 0.15rem;
    }

    .ayah-bn-translation .line {
      margin-bottom: 0.15rem;
    }

    /* RIGHT SIDE: Word Meaning + Grammar (New design) */
    .detail-panel {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      border-radius: 1rem;
      background: radial-gradient(circle at top, rgba(56, 189, 248, 0.18), transparent 55%),
                  radial-gradient(circle at bottom, rgba(129, 140, 248, 0.18), transparent 60%),
                  rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(148, 163, 184, 0.7);
      padding: 0.75rem;
      min-height: 220px;
    }

    .detail-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .detail-title {
      font-size: 0.85rem;
      font-weight: 600;
      color: #e2e8f0;
    }

    .detail-subtitle {
      font-size: 0.7rem;
      color: #94a3b8;
    }

    .detail-body {
      flex: 1;
      display: flex;
      flex-direction: row;
      gap: 0.5rem;
      margin-top: 0.3rem;
      min-height: 150px;
    }

    @media (max-width: 900px) {
      .detail-body {
        flex-direction: column;
      }
    }

    .detail-left, .detail-right {
      border-radius: 0.9rem;
      padding: 0.6rem;
      background: linear-gradient(to bottom right, rgba(15, 23, 42, 0.9), rgba(15, 23, 42, 0.8));
      border: 1px solid rgba(148, 163, 184, 0.4);
      overflow: auto;
    }

    .detail-left {
      flex: 1.1;
    }

    .detail-right {
      flex: 1;
      max-height: 60vh;
    }

    .detail-section-title {
      font-size: 0.7rem;
      color: #a5b4fc;
      font-weight: 600;
      margin-bottom: 0.2rem;
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .detail-section-title span.icon {
      font-size: 0.8rem;
    }

    .detail-word {
      font-size: 0.95rem;
      margin-bottom: 0.2rem;
      color: #e5e7eb;
      font-weight: 500;
    }

    .detail-meaning {
      font-size: 0.85rem;
      color: #e5e7eb;
      line-height: 1.6;
    }

    .detail-grammar-toggle {
      display: flex;
      justify-content: flex-end;
      margin-bottom: 0.25rem;
      gap: 0.25rem;
    }

    .detail-grammar-toggle button {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.85);
      padding: 0.15rem 0.5rem;
      font-size: 0.7rem;
      color: #cbd5f5;
      cursor: pointer;
    }

    .detail-grammar-toggle button.active {
      background: rgba(59, 130, 246, 0.2);
      border-color: rgba(129, 140, 248, 0.9);
    }

    .detail-grammar-text {
      font-size: 0.8rem;
      color: #e5e7eb;
      line-height: 1.7;
      white-space: pre-wrap;
    }

    .detail-placeholder {
      font-size: 0.8rem;
      color: #9ca3af;
      text-align: center;
      margin-top: 1.5rem;
    }

    /* FONT SIZE SLIDER */
    .slider-group {
      display: flex;
      align-items: center;
      gap: 0.35rem;
      font-size: 0.7rem;
      color: #9ca3af;
    }

    .slider-group label {
      white-space: nowrap;
    }

    .slider-group input[type="range"] {
      width: 80px;
    }

    .bismillah {
      margin-bottom: 0.6rem;
      padding: 0.45rem 0.55rem;
      border-radius: 0.75rem;
      border: 1px dashed rgba(148, 163, 184, 0.7);
      background: linear-gradient(to right, rgba(15, 23, 42, 0.9), rgba(15, 23, 42, 0.7));
    }

    .bismillah-ar {
      font-family: "Scheherazade New", "Amiri", "Noto Naskh Arabic", serif;
      direction: rtl;
      text-align: center;
      font-size: var(--arabic-font-size, 1.3rem);
      margin-bottom: 0.3rem;
    }

    .bismillah-bn {
      font-size: var(--bangla-font-size, 0.9rem);
      text-align: center;
      color: #e5e7eb;
    }

    .bismillah-bn .label {
      display: block;
      font-size: 0.7rem;
      color: #9ca3af;
      margin-bottom: 0.1rem;
    }

    .translation-settings {
      display: flex;
      gap: 0.4rem;
      flex-wrap: wrap;
      align-items: center;
    }

    .translation-settings label {
      font-size: 0.7rem;
      color: #9ca3af;
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <header>
      <div>
        <h1>‡¶ï‡ßÅ‡¶∞‡¶Ü‡¶® ‡¶∂‡¶¨‡ßç‡¶¶‡ßá‚Äì‡¶∂‡¶¨‡ßç‡¶¶‡ßá (‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ‡¶∏‡¶π)</h1>
        <div class="header-sub">‡¶∏‡ßÇ‡¶∞‡¶æ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®, ‡¶™‡¶∞‡ßá ‡¶Æ‡ßã‡¶° ‡¶ì ‡¶Ö‡¶®‡ßÅ‡¶¨‡¶æ‡¶¶ ‡¶¨‡ßá‡¶õ‡ßá ‡¶®‡¶ø‡¶®</div>
      </div>

      <div class="header-controls">
        <!-- Sura select -->
        <div class="select">
          <span>‡¶∏‡ßÇ‡¶∞‡¶æ:</span>
          <select id="suraSelect"></select>
        </div>

        <!-- Font size controls -->
        <div class="slider-group">
          <label for="arabicFont">‡¶Ü‡¶∞‡¶¨‡¶ø</label>
          <input id="arabicFont" type="range" min="18" max="34" value="24" />
        </div>
        <div class="slider-group">
          <label for="banglaFont">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</label>
          <input id="banglaFont" type="range" min="14" max="22" value="16" />
        </div>
      </div>
    </header>

    <main>
      <!-- LEFT PANEL -->
      <section class="panel" id="leftPanel">
        <div class="panel-header">
          <div>
            <div class="panel-title" id="suraTitle">‡¶∏‡ßÇ‡¶∞‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
            <div class="panel-subtitle" id="suraMeta"></div>
          </div>

          <div class="mode-toggle">
            <button id="modeWord" class="active">‡¶∂‡¶¨‡ßç‡¶¶‡ßá‚Äì‡¶∂‡¶¨‡ßç‡¶¶‡ßá</button>
            <button id="modeTrans">‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶Ö‡¶®‡ßÅ‡¶¨‡¶æ‡¶¶</button>
          </div>
        </div>

        <div id="bismillahContainer"></div>
        <div id="ayahContainer"></div>
      </section>

      <!-- RIGHT PANEL: Word meaning + Grammar -->
      <section class="detail-panel">
        <div class="detail-header">
          <div>
            <div class="detail-title">‡¶∂‡¶¨‡ßç‡¶¶‡ßá‡¶∞ ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§</div>
            <div class="detail-subtitle" id="detailSubtitle">‡¶Ü‡¶∞‡¶¨‡¶ø ‡¶ï‡ßã‡¶®‡ßã ‡¶∂‡¶¨‡ßç‡¶¶‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®</div>
          </div>

          <div class="translation-settings">
            <label>
              <input type="checkbox" id="showOsmani" checked />
              ‡¶§‡¶æ‡¶´‡¶∏‡ßÄ‡¶∞‡ßá ‡¶ì‡¶∏‡¶Æ‡¶æ‡¶®‡ßÄ
            </label>
            <label>
              <input type="checkbox" id="showTawjih" checked />
              ‡¶§‡¶æ‡¶ì‡¶Ø‡ßÄ‡¶π‡ßÅ‡¶≤ ‡¶ï‡ßÅ‡¶∞‡¶Ü‡¶®
            </label>
          </div>
        </div>

        <div class="detail-body" id="detailBody">
          <div class="detail-left">
            <div class="detail-section-title">
              <span class="icon">üî§</span> ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶∂‡¶¨‡ßç‡¶¶‡¶æ‡¶∞‡ßç‡¶•
            </div>
            <div class="detail-word" id="detailWord"></div>
            <div class="detail-meaning" id="detailMeaning"></div>
          </div>

          <div class="detail-right">
            <div class="detail-section-title">
              <span class="icon">üìò</span> ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶∞‡¶£ ‡¶®‡ßã‡¶ü
            </div>
            <div class="detail-grammar-toggle">
              <button id="grammarShowBtn" class="active">‡¶¶‡ßá‡¶ñ‡¶æ‡¶®</button>
              <button id="grammarHideBtn">‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®</button>
            </div>
            <div class="detail-grammar-text" id="detailGrammar"></div>
          </div>
        </div>

        <div class="detail-placeholder" id="detailPlaceholder">
          ‡¶ï‡ßã‡¶®‡ßã ‡¶Ü‡¶∞‡¶¨‡¶ø ‡¶∂‡¶¨‡ßç‡¶¶‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶§‡¶æ‡¶∞ <b>‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶Ö‡¶∞‡ßç‡¶•</b> ‡¶ì ‡¶°‡¶æ‡¶® ‡¶™‡¶æ‡¶∂‡ßá <b>‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶∞‡¶£ ‡¶®‡ßã‡¶ü</b> ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá‡•§
        </div>
      </section>
    </main>
  </div>

  <!-- Load sura list -->
  <script src="suras.js"></script>
  <script>
    const suraSelect = document.getElementById("suraSelect");
    const suraTitle = document.getElementById("suraTitle");
    const suraMeta = document.getElementById("suraMeta");
    const ayahContainer = document.getElementById("ayahContainer");
    const bismillahContainer = document.getElementById("bismillahContainer");

    const modeWordBtn = document.getElementById("modeWord");
    const modeTransBtn = document.getElementById("modeTrans");

    const detailSubtitle = document.getElementById("detailSubtitle");
    const detailWord = document.getElementById("detailWord");
    const detailMeaning = document.getElementById("detailMeaning");
    const detailGrammar = document.getElementById("detailGrammar");
    const detailPlaceholder = document.getElementById("detailPlaceholder");

    const grammarShowBtn = document.getElementById("grammarShowBtn");
    const grammarHideBtn = document.getElementById("grammarHideBtn");

    const showOsmaniCb = document.getElementById("showOsmani");
    const showTawjihCb = document.getElementById("showTawjih");

    const arabicFontSlider = document.getElementById("arabicFont");
    const banglaFontSlider = document.getElementById("banglaFont");

    let currentSuraData = null;
    let currentMode = "word"; // 'word' | 'trans'
    let activeWordToken = null;
    let grammarVisible = true;

    function applyFontSizes() {
      const a = arabicFontSlider.value;
      const b = banglaFontSlider.value;
      document.documentElement.style.setProperty("--arabic-font-size", a + "px");
      document.documentElement.style.setProperty("--bangla-font-size", b + "px");
    }

    arabicFontSlider.addEventListener("input", applyFontSizes);
    banglaFontSlider.addEventListener("input", applyFontSizes);
    applyFontSizes();

    function loadSuraList() {
      if (!window.suras) return;
      suraSelect.innerHTML = "";
      window.suras.forEach((s) => {
        const opt = document.createElement("option");
        opt.value = s.number;
        opt.textContent = `${s.number}. ${s.nameAr} ‚Äî ${s.nameBn}`;
        suraSelect.appendChild(opt);
      });

      const defaultSura = window.suras.find((s) => s.number === 103) || window.suras[0];
      if (defaultSura) {
        suraSelect.value = defaultSura.number;
        loadSura(defaultSura);
      }
    }

    suraSelect.addEventListener("change", () => {
      const num = parseInt(suraSelect.value, 10);
      const s = window.suras.find((x) => x.number === num);
      if (s) loadSura(s);
    });

    async function loadSura(suraMetaObj) {
      ayahContainer.innerHTML = "";
      bismillahContainer.innerHTML = "";
      currentSuraData = null;
      activeWordToken = null;
      detailWord.textContent = "";
      detailMeaning.textContent = "";
      detailGrammar.textContent = "";
      detailPlaceholder.style.display = "block";
      detailSubtitle.textContent = "‡¶Ü‡¶∞‡¶¨‡¶ø ‡¶ï‡ßã‡¶®‡ßã ‡¶∂‡¶¨‡ßç‡¶¶‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®";

      suraTitle.textContent = `${suraMetaObj.number}. ${suraMetaObj.nameAr} ‚Äî ${suraMetaObj.nameBn}`;
      suraMeta.textContent = `${suraMetaObj.type === "Makki" ? "‡¶Æ‡¶æ‡¶ï‡ßç‡¶ï‡ßÄ" : "‡¶Æ‡¶æ‡¶¶‡¶æ‡¶®‡ßÄ"} ‚Ä¢ ‡¶Ü‡ßü‡¶æ‡¶§: ${suraMetaObj.ayahCount}`;

      try {
        const res = await fetch(suraMetaObj.file);
        const data = await res.json();
        currentSuraData = data;
        renderSura();
      } catch (e) {
        console.error(e);
        ayahContainer.innerHTML = "<div style='color:#fecaca;font-size:0.9rem;'>‡¶è‡¶á ‡¶∏‡ßÇ‡¶∞‡¶æ‡¶∞ JSON ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§</div>";
      }
    }

    function renderSura() {
      if (!currentSuraData) return;
      ayahContainer.innerHTML = "";
      bismillahContainer.innerHTML = "";

      // Bismillah (full line)
      if (currentSuraData.hasBismillah && currentSuraData.bismillah) {
        const box = document.createElement("div");
        box.className = "bismillah";

        const ar = document.createElement("div");
        ar.className = "bismillah-ar";
        ar.textContent = currentSuraData.bismillah.arabic || "ÿ®Ÿêÿ≥ŸíŸÖŸê ÿßŸÑŸÑŸëŸéŸáŸê ÿßŸÑÿ±ŸëŸéÿ≠ŸíŸÖŸéŸÜŸê ÿßŸÑÿ±ŸëŸéÿ≠ŸêŸäŸÖŸê";

        const bn = document.createElement("div");
        bn.className = "bismillah-bn";

        const label = document.createElement("span");
        label.className = "label";
        label.textContent = "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶Ö‡¶®‡ßÅ‡¶¨‡¶æ‡¶¶:";

        const text = document.createElement("div");
        const parts = [];
        if (currentSuraData.bismillah.translations?.osmani) {
          parts.push("‡¶§‡¶æ‡¶´‡¶∏‡ßÄ‡¶∞‡ßá ‡¶ì‡¶∏‡¶Æ‡¶æ‡¶®‡ßÄ: " + currentSuraData.bismillah.translations.osmani);
        }
        if (currentSuraData.bismillah.translations?.tawjih) {
          parts.push("‡¶§‡¶æ‡¶ì‡¶Ø‡ßÄ‡¶π‡ßÅ‡¶≤ ‡¶ï‡ßÅ‡¶∞‡¶Ü‡¶®: " + currentSuraData.bismillah.translations.tawjih);
        }
        text.textContent = parts.join(" | ");

        bn.appendChild(label);
        bn.appendChild(text);

        box.appendChild(ar);
        box.appendChild(bn);
        bismillahContainer.appendChild(box);
      }

      currentSuraData.ayahs.forEach((ayah) => {
        const ayahDiv = document.createElement("div");
        ayahDiv.className = "ayah";

        const header = document.createElement("div");
        header.className = "ayah-header";

        const num = document.createElement("div");
        num.className = "ayah-number";
        num.textContent = `‡¶Ü‡ßü‡¶æ‡¶§ ${ayah.ayahNumber}`;
        header.appendChild(num);

        const meta = document.createElement("div");
        meta.className = "ayah-meta";
        meta.textContent = "";
        header.appendChild(meta);

        ayahDiv.appendChild(header);

        const ar = document.createElement("div");
        ar.className = "ayah-arabic";

        if (Array.isArray(ayah.words) && ayah.words.length > 0) {
          ayah.words.forEach((w, idx) => {
            const span = document.createElement("span");
            span.className = "word-token";
            span.textContent = w.text || "";
            span.dataset.ayah = ayah.ayahNumber;
            span.dataset.index = idx;
            span.addEventListener("click", () => onWordClick(span, ayah, w, idx));
            ar.appendChild(span);
          });
        } else {
          ar.textContent = ayah.arabic || "";
        }

        ayahDiv.appendChild(ar);

        const bnTrans = document.createElement("div");
        bnTrans.className = "ayah-bn-translation";

        const label = document.createElement("div");
        label.className = "label";
        label.textContent = "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶Ö‡¶®‡ßÅ‡¶¨‡¶æ‡¶¶:";
        bnTrans.appendChild(label);

        if (ayah.translations) {
          if (ayah.translations.osmani) {
            const l1 = document.createElement("div");
            l1.className = "line";
            l1.textContent = `‡¶§‡¶æ‡¶´‡¶∏‡ßÄ‡¶∞‡ßá ‡¶ì‡¶∏‡¶Æ‡¶æ‡¶®‡ßÄ: ${ayah.translations.osmani}`;
            bnTrans.appendChild(l1);
          }
          if (ayah.translations.tawjih) {
            const l2 = document.createElement("div");
            l2.className = "line";
            l2.textContent = `‡¶§‡¶æ‡¶ì‡¶Ø‡ßÄ‡¶π‡ßÅ‡¶≤ ‡¶ï‡ßÅ‡¶∞‡¶Ü‡¶®: ${ayah.translations.tawjih}`;
            bnTrans.appendChild(l2);
          }
        }

        ayahDiv.appendChild(bnTrans);
        ayahContainer.appendChild(ayahDiv);
      });

      updateModeUI();
    }

    function onWordClick(span, ayah, word, index) {
      if (activeWordToken) {
        activeWordToken.classList.remove("active");
      }
      activeWordToken = span;
      span.classList.add("active");

      detailSubtitle.textContent = `‡¶Ü‡ßü‡¶æ‡¶§ ${ayah.ayahNumber} ‚Äî ‡¶∂‡¶¨‡ßç‡¶¶ ${index + 1}`;
      detailPlaceholder.style.display = "none";

      detailWord.textContent = word.text || "";
      detailMeaning.textContent = word.meaningBn || "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶Ö‡¶∞‡ßç‡¶• ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§";

      detailGrammar.textContent = word.notes || "‡¶è‡¶á ‡¶∂‡¶¨‡ßç‡¶¶‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶∞‡¶£ ‡¶®‡ßã‡¶ü ‡¶è‡¶ñ‡¶®‡ßã ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡¶®‡¶ø‡•§";

      if (!grammarVisible) {
        detailGrammar.style.display = "none";
      } else {
        detailGrammar.style.display = "block";
      }
    }

    function updateModeUI() {
      const isWordMode = currentMode === "word";

      modeWordBtn.classList.toggle("active", isWordMode);
      modeTransBtn.classList.toggle("active", !isWordMode);

      const ayahs = ayahContainer.querySelectorAll(".ayah");
      ayahs.forEach((ayahDiv) => {
        const ar = ayahDiv.querySelector(".ayah-arabic");
        const bn = ayahDiv.querySelector(".ayah-bn-translation");

        if (isWordMode) {
          ar.style.display = "block";
          bn.style.display = "none";
        } else {
          ar.style.display = "block"; // Arabic always visible
          // Translation visible depending on checkboxes
          const hasAny = showOsmaniCb.checked || showTawjihCb.checked;
          bn.style.display = hasAny ? "block" : "none";

          // Filter lines inside translation
          const lines = bn.querySelectorAll(".line");
          lines.forEach((line) => {
            if (line.textContent.startsWith("‡¶§‡¶æ‡¶´‡¶∏‡ßÄ‡¶∞‡ßá ‡¶ì‡¶∏‡¶Æ‡¶æ‡¶®‡ßÄ")) {
              line.style.display = showOsmaniCb.checked ? "block" : "none";
            } else if (line.textContent.startsWith("‡¶§‡¶æ‡¶ì‡¶Ø‡ßÄ‡¶π‡ßÅ‡¶≤ ‡¶ï‡ßÅ‡¶∞‡¶Ü‡¶®")) {
              line.style.display = showTawjihCb.checked ? "block" : "none";
            }
          });
        }
      });

      // Bismillah translation also obey checkboxes when in "‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶Ö‡¶®‡ßÅ‡¶¨‡¶æ‡¶¶"
      if (currentSuraData && currentSuraData.hasBismillah && currentSuraData.bismillah) {
        const bTextDiv = bismillahContainer.querySelector(".bismillah-bn div:last-child");
        if (bTextDiv) {
          const os = currentSuraData.bismillah.translations?.osmani || "";
          const tw = currentSuraData.bismillah.translations?.tawjih || "";
          const parts = [];
          if (showOsmaniCb.checked && os) parts.push("‡¶§‡¶æ‡¶´‡¶∏‡ßÄ‡¶∞‡ßá ‡¶ì‡¶∏‡¶Æ‡¶æ‡¶®‡ßÄ: " + os);
          if (showTawjihCb.checked && tw) parts.push("‡¶§‡¶æ‡¶ì‡¶Ø‡ßÄ‡¶π‡ßÅ‡¶≤ ‡¶ï‡ßÅ‡¶∞‡¶Ü‡¶®: " + tw);
          bTextDiv.textContent = parts.join(" | ");
        }
      }
    }

    modeWordBtn.addEventListener("click", () => {
      currentMode = "word";
      updateModeUI();
    });

    modeTransBtn.addEventListener("click", () => {
      currentMode = "trans";
      updateModeUI();
    });

    showOsmaniCb.addEventListener("change", updateModeUI);
    showTawjihCb.addEventListener("change", updateModeUI);

    grammarShowBtn.addEventListener("click", () => {
      grammarVisible = true;
      grammarShowBtn.classList.add("active");
      grammarHideBtn.classList.remove("active");
      detailGrammar.style.display = "block";
    });

    grammarHideBtn.addEventListener("click", () => {
      grammarVisible = false;
      grammarHideBtn.classList.add("active");
      grammarShowBtn.classList.remove("active");
      detailGrammar.style.display = "none";
    });

    window.addEventListener("DOMContentLoaded", loadSuraList);
  </script>
</body>
</html>
