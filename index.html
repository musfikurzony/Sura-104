<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <title>Qur'an Ayaat Toolkit</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg-main: radial-gradient(circle at top left, #e0f2fe, #eef2ff, #fefce8);
      --card-bg: rgba(255,255,255,0.9);
      --glass-bg: rgba(15,23,42,0.68);
      --primary: #1f2937;
      --accent: #0ea5e9;
      --accent-soft: rgba(14,165,233,0.12);
      --accent-strong: #0284c7;
      --danger-soft: #fee2e2;
      --danger: #b91c1c;
      --radius-xl: 18px;
      --radius-lg: 14px;
      --radius-pill: 999px;
      --shadow-soft: 0 18px 45px rgba(15,23,42,0.15);
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      min-height: 100vh;
      background: var(--bg-main);
      color: #0f172a;
      display: flex;
      flex-direction: column;
    }

    .app-shell {
      max-width: 1280px;
      margin: 12px auto;
      padding: 8px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    /* Top app header */
    .app-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      padding: 10px 14px;
      border-radius: var(--radius-xl);
      background: rgba(255,255,255,0.85);
      box-shadow: 0 8px 25px rgba(15,23,42,0.08);
      backdrop-filter: blur(10px);
    }
    .app-title-block {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .app-logo {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: conic-gradient(from 180deg, #0ea5e9, #22c55e, #f97316, #0ea5e9);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 18px;
      box-shadow: 0 10px 25px rgba(14,165,233,0.4);
    }
    .app-title-text {
      display: flex;
      flex-direction: column;
      gap: 1px;
    }
    .app-title-main {
      font-weight: 700;
      font-size: 18px;
      letter-spacing: 0.02em;
      color: #0f172a;
    }
    .app-title-sub {
      font-size: 12px;
      color: #6b7280;
    }

    .app-header-right {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      color: #64748b;
    }
    .pill-tag {
      border-radius: var(--radius-pill);
      padding: 4px 8px;
      background: rgba(15,23,42,0.03);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .pill-tag span.emoji {
      font-size: 14px;
    }

    /* Layout: sidebar + main */
    .app-body {
      display: grid;
      grid-template-columns: 290px minmax(0,1fr);
      gap: 12px;
      min-height: 0;
    }

    /* Sidebar (glass) */
    .sidebar {
      display: flex;
      flex-direction: column;
      gap: 10px;
      background: var(--glass-bg);
      border-radius: 20px;
      padding: 10px;
      color: #e5e7eb;
      box-shadow: var(--shadow-soft);
      backdrop-filter: blur(14px);
      border: 1px solid rgba(148,163,184,0.35);
    }

    .sidebar-section {
      background: radial-gradient(circle at top left, rgba(15,23,42,0.4), rgba(15,23,42,0.85));
      border-radius: 14px;
      padding: 10px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .sidebar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .sidebar-header-title {
      font-size: 13px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .sidebar-header-title span.emoji {
      font-size: 15px;
    }
    .sidebar-header button {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.9);
      background: rgba(15,23,42,0.4);
      color: #e5e7eb;
      font-size: 11px;
      padding: 3px 8px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .sidebar-header button:hover {
      background: rgba(148,163,184,0.18);
    }

    .sidebar-search {
      position: relative;
    }
    .sidebar-search input {
      width: 100%;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.7);
      padding: 6px 26px 6px 24px;
      font-size: 12px;
      outline: none;
      background: rgba(15,23,42,0.7);
      color: #e5e7eb;
    }
    .sidebar-search-icon {
      position: absolute;
      left: 8px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 12px;
      opacity: 0.7;
    }

    .sura-list {
      max-height: 185px;
      overflow-y: auto;
      padding-right: 4px;
      margin-top: 4px;
      scrollbar-width: thin;
      scrollbar-color: rgba(148,163,184,0.9) transparent;
    }
    .sura-list::-webkit-scrollbar {
      width: 6px;
    }
    .sura-list::-webkit-scrollbar-thumb {
      background: rgba(148,163,184,0.9);
      border-radius: 999px;
    }

    .sura-item {
      border-radius: 10px;
      padding: 6px 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      transition: background 0.15s, transform 0.1s;
    }
    .sura-item:hover {
      background: rgba(15,23,42,0.75);
      transform: translateY(-1px);
    }
    .sura-item.active {
      background: linear-gradient(90deg, rgba(56,189,248,0.35), rgba(59,130,246,0.4));
    }

    .sura-item-left {
      display: flex;
      flex-direction: column;
      gap: 1px;
      font-size: 12px;
    }
    .sura-item-title {
      font-weight: 500;
    }
    .sura-item-meta {
      font-size: 11px;
      opacity: 0.8;
    }
    .sura-item-right {
      font-family: "Scheherazade", "Amiri", "Traditional Arabic", system-ui;
      font-size: 18px;
    }

    /* Last read box */
    .last-read-box {
      font-size: 12px;
      line-height: 1.5;
      background: radial-gradient(circle at top left, rgba(16,185,129,0.2), rgba(15,23,42,0.9));
      border-radius: 12px;
      padding: 8px 9px;
      border: 1px solid rgba(16,185,129,0.4);
    }
    .last-read-box strong {
      font-weight: 600;
      color: #bbf7d0;
    }
    .last-read-preview {
      margin-top: 4px;
      color: #d1fae5;
      opacity: 0.9;
    }
    .last-read-actions {
      margin-top: 6px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
    }
    .btn-last-read-go {
      border-radius: 999px;
      border: none;
      padding: 4px 9px;
      font-size: 11px;
      cursor: pointer;
      background: #ecfeff;
      color: #065f46;
      font-weight: 600;
    }
    .btn-last-read-clear {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.7);
      padding: 3px 8px;
      font-size: 11px;
      cursor: pointer;
      background: transparent;
      color: #e5e7eb;
    }

    /* Sidebar mini pins/favs */
    .sidebar-mini-list {
      max-height: 160px;
      overflow-y: auto;
      padding-right: 4px;
      scrollbar-width: thin;
    }
    .sidebar-mini-item {
      border-radius: 10px;
      padding: 5px 8px;
      background: rgba(15,23,42,0.8);
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 11px;
      margin-bottom: 4px;
    }
    .sidebar-mini-main {
      display: flex;
      flex-direction: column;
      gap: 1px;
      max-width: 165px;
    }
    .sidebar-mini-main strong {
      font-weight: 600;
    }
    .sidebar-mini-main small {
      opacity: 0.8;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .sidebar-mini-actions button {
      border-radius: 999px;
      border: none;
      padding: 3px 7px;
      font-size: 11px;
      cursor: pointer;
      background: rgba(148,163,184,0.2);
      color: #e5e7eb;
    }

    /* Main area */
    .main {
      display: flex;
      flex-direction: column;
      gap: 10px;
      min-width: 0;
    }

    /* Sura bar */
    .sura-bar-card {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 10px 12px;
      box-shadow: var(--shadow-soft);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      border: 1px solid rgba(209,213,219,0.5);
    }
    .sura-bar-left {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .sura-bar-label {
      font-size: 11px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: #9ca3af;
    }
    .sura-bar-name {
      font-size: 17px;
      font-weight: 700;
      display: inline-flex;
      align-items: baseline;
      gap: 6px;
    }
    .sura-bar-name span.ar {
      font-family: "Scheherazade", "Amiri", system-ui;
      font-size: 18px;
    }
    .sura-bar-sub {
      font-size: 11px;
      color: #6b7280;
      display: flex;
      align-items: center;
      gap: 6px;
      margin-top: 2px;
    }
    .pill-mini {
      border-radius: 999px;
      background: rgba(14,165,233,0.08);
      padding: 2px 7px;
      font-size: 11px;
      color: #0369a1;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .sura-bar-right {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      justify-content: flex-end;
      align-items: center;
    }

    .btn {
      border-radius: 999px;
      border: none;
      padding: 6px 10px;
      font-size: 11px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      white-space: nowrap;
    }
    .btn-primary {
      background: linear-gradient(135deg, #1d4ed8, #0ea5e9);
      color: white;
      box-shadow: 0 8px 18px rgba(37,99,235,0.45);
    }
    .btn-ghost {
      background: rgba(15,23,42,0.03);
      color: #0f172a;
      border: 1px solid rgba(209,213,219,0.9);
    }

    /* View controls group */
    .view-controls {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 4px 6px;
      border-radius: 999px;
      background: rgba(15,23,42,0.03);
    }
    .toggle-group {
      display: inline-flex;
      border-radius: 999px;
      border: 1px solid rgba(209,213,219,0.9);
      overflow: hidden;
      background: white;
    }
    .toggle-group button {
      border: none;
      padding: 4px 8px;
      font-size: 10px;
      cursor: pointer;
      background: transparent;
      color: #6b7280;
      min-width: 70px;
    }
    .toggle-group button.active {
      background: #0f172a;
      color: #f9fafb;
    }
    .font-slider {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 11px;
      color: #6b7280;
    }
    .font-slider input {
      width: 90px;
    }

    /* Aya list card */
    .aya-card {
      background: var(--card-bg);
      border-radius: 22px;
      padding: 10px;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(209,213,219,0.7);
      display: flex;
      flex-direction: column;
      min-height: 0;
      position: relative;
    }
    .aya-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
      padding: 0 4px 4px;
      border-bottom: 1px solid rgba(209,213,219,0.7);
      margin-bottom: 4px;
    }
    .aya-card-title {
      font-size: 12px;
      color: #64748b;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .aya-card-title span.icon {
      width: 22px;
      height: 22px;
      border-radius: 999px;
      background: rgba(14,165,233,0.08);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 13px;
    }
    .aya-card-count {
      font-size: 11px;
      color: #6b7280;
    }

    .aya-list {
      flex: 1;
      margin-top: 4px;
      border-radius: 14px;
      overflow: hidden;
      border: 1px solid rgba(226,232,240,0.9);
      background: linear-gradient(to bottom, #f9fafb, #fdfdfd);
      max-height: calc(100vh - 240px);
      overflow-y: auto;
      scrollbar-width: thin;
    }
    .aya-list::-webkit-scrollbar {
      width: 6px;
    }
    .aya-list::-webkit-scrollbar-thumb {
      background: rgba(148,163,184,0.8);
      border-radius: 999px;
    }

    .aya-row {
      display: grid;
      grid-template-columns: auto minmax(0, 1fr) auto;
      gap: 8px;
      padding: 8px 10px;
      border-bottom: 1px solid rgba(226,232,240,0.9);
      background: white;
      transition: background 0.12s, box-shadow 0.12s;
    }
    .aya-row:hover {
      background: #eff6ff;
      box-shadow: 0 1px 0 rgba(37,99,235,0.16) inset;
    }

    .aya-select {
      padding-top: 5px;
    }
    .aya-select input {
      width: 16px;
      height: 16px;
      cursor: pointer;
    }

    .aya-text {
      display: flex;
      flex-direction: column;
      gap: 4px;
      min-width: 0;
    }
    .aya-meta {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
      font-size: 11px;
      color: #6b7280;
    }
    .aya-number-pill {
      border-radius: 999px;
      padding: 2px 8px;
      background: rgba(15,23,42,0.03);
      border: 1px solid rgba(209,213,219,0.8);
      font-weight: 500;
    }

    .aya-tags {
      display: inline-flex;
      gap: 4px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }
    .tag-pill {
      border-radius: 999px;
      padding: 2px 6px;
      font-size: 10px;
      background: rgba(249,250,251,0.9);
      border: 1px solid rgba(226,232,240,0.9);
      display: inline-flex;
      align-items: center;
      gap: 3px;
    }
    .tag-pill.pin { color: #92400e; border-color: rgba(248,250,252,0.7); background: #fef3c7; }
    .tag-pill.fav { color: #9a3412; border-color: rgba(254,215,170,0.9); background: #ffedd5; }

    .aya-arabic {
      font-family: "Scheherazade", "Amiri", "Traditional Arabic", system-ui;
      font-size: 22px;
      line-height: 1.7;
      text-align: right;
      direction: rtl;
      word-spacing: 3px;
      color: #0f172a;
    }
    .aya-bangla {
      font-size: 14px;
      line-height: 1.9;
      text-align: justify;
      color: #1f2933;
    }

    .aya-actions {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 6px;
      font-size: 11px;
    }

    .aya-actions-top {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      justify-content: flex-end;
    }
    .icon-chip {
      border-radius: 999px;
      border: 1px solid rgba(209,213,219,0.9);
      padding: 3px 7px;
      font-size: 11px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      background: #f9fafb;
      cursor: pointer;
    }
    .icon-chip span.icon {
      font-size: 13px;
    }
    .icon-chip.pin-active {
      background: #fef3c7;
      border-color: #facc15;
      color: #854d0e;
    }
    .icon-chip.fav-active {
      background: #ffedd5;
      border-color: #fdba74;
      color: #9a3412;
    }
    .icon-chip.main {
      background: #0f172a;
      border-color: #0f172a;
      color: #e5e7eb;
    }

    .aya-actions-bottom {
      font-size: 10px;
      color: #9ca3af;
      display: flex;
      gap: 4px;
      align-items: center;
    }

    /* multi select bar */
    .multi-select-bar {
      position: sticky;
      bottom: 0;
      left: 0;
      right: 0;
      border-radius: 0 0 18px 18px;
      padding: 6px 10px;
      background: linear-gradient(90deg, #0f172a, #1e293b);
      display: none;
      justify-content: space-between;
      align-items: center;
      color: #e5e7eb;
      font-size: 12px;
    }
    .multi-select-bar.active {
      display: flex;
    }
    .multi-select-actions {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .multi-select-actions button {
      border-radius: 999px;
      border: none;
      padding: 4px 8px;
      font-size: 11px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 3px;
    }
    .multi-copy {
      background: #f1f5f9;
      color: #020617;
    }
    .multi-share {
      background: #0ea5e9;
      color: white;
    }
    .multi-clear {
      background: transparent;
      color: #e5e7eb;
      border: 1px solid rgba(148,163,184,0.9);
    }

    /* Floating settings button */
    .floating-settings-btn {
      position: fixed;
      bottom: 16px;
      right: 14px;
      border-radius: 999px;
      border: none;
      padding: 10px 12px;
      font-size: 13px;
      cursor: pointer;
      background: linear-gradient(135deg, #0f172a, #111827);
      color: #e5e7eb;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 20px 40px rgba(15,23,42,0.4);
      z-index: 40;
    }

    /* Modals (same as before but with refined styling) */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,0.55);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 50;
      backdrop-filter: blur(8px);
    }
    .modal-backdrop.active {
      display: flex;
    }
    .modal {
      background: #f9fafb;
      border-radius: 20px;
      width: min(700px, 96vw);
      max-height: 92vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      box-shadow: 0 30px 70px rgba(15,23,42,0.45);
      border: 1px solid rgba(209,213,219,0.9);
    }
    .modal-header {
      padding: 10px 14px;
      border-bottom: 1px solid rgba(226,232,240,0.9);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
      background: linear-gradient(90deg, #0f172a, #1e293b);
      color: #e5e7eb;
    }
    .modal-header h2 {
      font-size: 14px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .modal-body {
      padding: 10px 12px;
      overflow-y: auto;
      font-size: 13px;
    }
    .modal-footer {
      padding: 8px 12px;
      border-top: 1px solid rgba(226,232,240,0.9);
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      background: #f9fafb;
    }
    .close-btn {
      border-radius: 999px;
      border: 1px solid rgba(209,213,219,0.9);
      background: rgba(249,250,251,0.95);
      padding: 4px 9px;
      font-size: 11px;
      cursor: pointer;
    }

    .copy-preview {
      width: 100%;
      min-height: 140px;
      border-radius: 14px;
      border: 1px solid rgba(209,213,219,0.9);
      padding: 8px;
      font-size: 13px;
      resize: vertical;
      background: white;
    }

    .radio-group {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 8px;
    }
    .radio-pill {
      border-radius: 999px;
      border: 1px solid rgba(209,213,219,0.9);
      padding: 3px 8px;
      font-size: 12px;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      cursor: pointer;
      background: white;
    }
    .radio-pill input {
      margin: 0;
    }

    .settings-group {
      margin-bottom: 10px;
    }
    .settings-group label {
      font-size: 12px;
      font-weight: 600;
      display: block;
      margin-bottom: 4px;
      color: #4b5563;
    }
    .settings-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: center;
      font-size: 12px;
    }
    .chip {
      border-radius: 999px;
      border: 1px solid rgba(209,213,219,0.9);
      padding: 3px 8px;
      cursor: pointer;
      background: white;
      color: #4b5563;
      font-size: 12px;
    }
    .chip.active {
      background: #0f172a;
      color: #e5e7eb;
      border-color: #0f172a;
    }

    /* Pins modal list */
    #pinsListContainer > div {
      border-radius: 12px;
      background: white;
      border: 1px solid rgba(226,232,240,0.9);
      padding: 6px 8px;
      margin-bottom: 6px;
    }

    /* Responsive */
    @media (max-width: 960px) {
      .app-body {
        grid-template-columns: minmax(0,1fr);
      }
      .sidebar {
        order: 2;
      }
      .main {
        order: 1;
      }
    }
    @media (max-width: 720px) {
      .app-shell {
        margin: 6px auto 10px;
        padding: 6px;
      }
      .app-header {
        flex-direction: column;
        align-items: flex-start;
      }
      .sura-bar-card {
        flex-direction: column;
        align-items: flex-start;
      }
      .sura-bar-right {
        width: 100%;
        justify-content: space-between;
      }
      .aya-list {
        max-height: calc(100vh - 260px);
      }
      .floating-settings-btn {
        right: 10px;
        bottom: 10px;
      }
    }
  </style>
</head>
<body>

<div class="app-shell">
  <!-- Top header -->
  <header class="app-header">
    <div class="app-title-block">
      <div class="app-logo">Ôªï</div>
      <div class="app-title-text">
        <div class="app-title-main">Qur'an Ayaat Toolkit</div>
        <div class="app-title-sub">‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶™‡¶ø‡¶®, ‡¶´‡ßá‡¶≠‡¶æ‡¶∞‡¶ø‡¶ü, ‡¶ï‡¶™‡¶ø ‡¶ì ‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‚Äì ‡¶è‡¶ï ‡¶ú‡¶æ‡ßü‡¶ó‡¶æ‡ßü</div>
      </div>
    </div>
    <div class="app-header-right">
      <div class="pill-tag"><span class="emoji">üìå</span><span>Pin & Favourites</span></div>
      <div class="pill-tag"><span class="emoji">üìã</span><span>Multi Ayaat Copy</span></div>
      <div class="pill-tag"><span class="emoji">‚öôÔ∏è</span><span>Custom View</span></div>
    </div>
  </header>

  <div class="app-body">
    <!-- SIDEBAR -->
    <aside class="sidebar">
      <!-- Sura list -->
      <section class="sidebar-section">
        <div class="sidebar-header">
          <div class="sidebar-header-title">
            <span class="emoji">üìñ</span><span>‡¶∏‡ßÇ‡¶∞‡¶æ‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</span>
          </div>
          <button id="openSuraListModalBtn">‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</button>
        </div>
        <div class="sidebar-search">
          <span class="sidebar-search-icon">üîç</span>
          <input id="sidebarSuraSearch" type="text" placeholder="‡¶®‡¶æ‡¶Æ / ‡¶®‡¶Ç ‡¶¶‡¶ø‡ßü‡ßá ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®..." />
        </div>
        <div id="sidebarSuraList" class="sura-list"></div>
      </section>

      <!-- Last read -->
      <section class="sidebar-section">
        <div class="sidebar-header">
          <div class="sidebar-header-title">
            <span class="emoji">‚è±</span><span>‡¶∏‡¶∞‡ßç‡¶¨‡¶∂‡ßá‡¶∑ ‡¶™‡ßú‡¶æ</span>
          </div>
          <button id="clearLastReadBtn">‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>
        </div>
        <div id="lastReadBox" class="last-read-box">
          ‡¶è‡¶ñ‡¶®‡ßã ‡¶ï‡ßã‡¶®‡ßã ‡¶Ü‡ßü‡¶æ‡¶§‡¶ï‡ßá ‡¶∏‡¶∞‡ßç‡¶¨‡¶∂‡ßá‡¶∑ ‡¶™‡ßú‡¶æ ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡¶®‡¶ø‡•§
        </div>
      </section>

      <!-- Pins / Favs mini -->
      <section class="sidebar-section">
        <div class="sidebar-header">
          <div class="sidebar-header-title">
            <span class="emoji">‚≠ê</span><span>‡¶™‡¶ø‡¶® ‡¶ì ‡¶´‡ßá‡¶≠‡¶æ‡¶∞‡¶ø‡¶ü</span>
          </div>
          <button id="openPinsModalBtn">‡¶∏‡¶¨ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>
        </div>
        <div id="sidebarPinsFavs" class="sidebar-mini-list"></div>
      </section>
    </aside>

    <!-- MAIN -->
    <main class="main">
      <!-- Sura bar -->
      <section class="sura-bar-card">
        <div class="sura-bar-left">
          <div class="sura-bar-label">‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶∏‡ßÇ‡¶∞‡¶æ</div>
          <div id="currentSuraName" class="sura-bar-name">
            ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...
          </div>
          <div class="sura-bar-sub">
            <span id="currentSuraStats">‚Äì</span>
            <span class="pill-mini">‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶™‡¶ø‡¶®, ‡¶´‡ßá‡¶≠‡¶æ‡¶∞‡¶ø‡¶ü ‡¶ì ‡¶ï‡¶™‡¶ø</span>
          </div>
        </div>
        <div class="sura-bar-right">
          <div class="view-controls">
            <div class="toggle-group" id="viewToggle">
              <button data-view="both" class="active">‡¶Ü‡¶∞‡¶¨‡¶ø + ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</button>
              <button data-view="ar">‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶Ü‡¶∞‡¶¨‡¶ø</button>
              <button data-view="bn">‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</button>
            </div>
            <div class="font-slider">
              <span>‡¶´‡¶®‡ßç‡¶ü:</span>
              <input id="fontSizeRange" type="range" min="14" max="28" step="1" value="18" />
            </div>
          </div>
          <button id="openSettingsModalBtn" class="btn btn-ghost">‚öôÔ∏è ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</button>
          <button id="openCopyModalBtn" class="btn btn-primary">üìã ‡¶Æ‡¶æ‡¶≤‡ßç‡¶ü‡¶ø ‡¶ï‡¶™‡¶ø / ‡¶∂‡ßá‡ßü‡¶æ‡¶∞</button>
        </div>
      </section>

      <!-- Ayaat card -->
      <section class="aya-card">
        <div class="aya-card-header">
          <div class="aya-card-title">
            <span class="icon">üìú</span>
            <span>‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶Ü‡ßü‡¶æ‡¶§‡¶∏‡¶Æ‡ßÇ‡¶π</span>
          </div>
          <div id="ayaCountLabel" class="aya-card-count">‡ß¶ ‡¶ü‡¶ø ‡¶Ü‡ßü‡¶æ‡¶§</div>
        </div>

        <div id="ayaList" class="aya-list"></div>

        <div id="multiSelectBar" class="multi-select-bar">
          <div id="multiSelectCount">‡ß¶ ‡¶ü‡¶ø ‡¶Ü‡ßü‡¶æ‡¶§ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶ø‡¶§</div>
          <div class="multi-select-actions">
            <button id="multiCopyBtn" class="multi-copy">üìã ‡¶ï‡¶™‡¶ø</button>
            <button id="multiShareBtn" class="multi-share">üîó ‡¶∂‡ßá‡ßü‡¶æ‡¶∞</button>
            <button id="multiClearBtn" class="multi-clear">‚úñ ‡¶ï‡ßç‡¶≤‡¶ø‡ßü‡¶æ‡¶∞</button>
          </div>
        </div>
      </section>
    </main>
  </div>
</div>

<!-- Floating Settings -->
<button id="floatingSettingsBtn" class="floating-settings-btn">
  ‚öôÔ∏è ‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏
</button>

<!-- MODALS -->

<!-- Sura List Modal -->
<div id="suraListModal" class="modal-backdrop">
  <div class="modal">
    <div class="modal-header">
      <h2>üìñ ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶∏‡ßÇ‡¶∞‡¶æ‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h2>
      <button class="close-btn" data-close-modal="suraListModal">‡¶¨‡¶®‡ßç‡¶ß</button>
    </div>
    <div class="modal-body">
      <div class="sidebar-search" style="margin-bottom:6px;">
        <span class="sidebar-search-icon">üîç</span>
        <input id="modalSuraSearch" type="text" placeholder="‡¶∏‡ßÅ‡¶∞‡¶æ ‡¶®‡¶æ‡¶Æ / ‡¶®‡¶Ç..." style="background:white;color:#0f172a;border-color:#e5e7eb;">
      </div>
      <div id="modalSuraList" class="sura-list" style="max-height:60vh;background:white;border-radius:12px;border:1px solid rgba(226,232,240,0.9);"></div>
    </div>
  </div>
</div>

<!-- Settings Modal -->
<div id="settingsModal" class="modal-backdrop">
  <div class="modal">
    <div class="modal-header">
      <h2>‚öôÔ∏è ‡¶™‡ßç‡¶∞‡¶¶‡¶∞‡ßç‡¶∂‡¶® ‡¶ì ‡¶™‡¶õ‡¶®‡ßç‡¶¶‡¶∏‡¶Æ‡ßÇ‡¶π</h2>
      <button class="close-btn" data-close-modal="settingsModal">‡¶¨‡¶®‡ßç‡¶ß</button>
    </div>
    <div class="modal-body">
      <div class="settings-group">
        <label>‡¶¶‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶ß‡¶∞‡¶®</label>
        <div class="settings-row" id="settingsViewChips">
          <span class="chip active" data-view="both">‡¶Ü‡¶∞‡¶¨‡¶ø + ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</span>
          <span class="chip" data-view="ar">‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶Ü‡¶∞‡¶¨‡¶ø</span>
          <span class="chip" data-view="bn">‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</span>
        </div>
      </div>

      <div class="settings-group">
        <label>‡¶´‡¶®‡ßç‡¶ü ‡¶∏‡¶æ‡¶á‡¶ú</label>
        <div class="settings-row">
          <span style="font-size:11px;">‡ßß‡ß™</span>
          <input id="settingsFontSizeRange" type="range" min="14" max="28" step="1" value="18" />
          <span style="font-size:11px;">‡ß®‡ßÆ</span>
        </div>
      </div>

      <div class="settings-group">
        <label>‡¶≤‡¶æ‡¶á‡¶® ‡¶∏‡ßç‡¶™‡ßá‡¶∏‡¶ø‡¶Ç</label>
        <div class="settings-row" id="lineHeightChips">
          <span class="chip active" data-lh="1.7">‡¶ï‡¶Æ‡¶´‡ßã‡¶∞‡ßç‡¶ü</span>
          <span class="chip" data-lh="1.9">‡¶∞‡¶ø‡¶≤‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶∏</span>
          <span class="chip" data-lh="2.1">‡¶è‡¶ï‡ßç‡¶∏‡¶ü‡ßç‡¶∞‡¶æ</span>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="close-btn" data-close-modal="settingsModal">‡¶†‡¶ø‡¶ï ‡¶Ü‡¶õ‡ßá</button>
    </div>
  </div>
</div>

<!-- Copy / Share Modal -->
<div id="copyModal" class="modal-backdrop">
  <div class="modal">
    <div class="modal-header">
      <h2>üìã ‡¶ï‡¶™‡¶ø / üîó ‡¶∂‡ßá‡ßü‡¶æ‡¶∞</h2>
      <button class="close-btn" data-close-modal="copyModal">‡¶¨‡¶®‡ßç‡¶ß</button>
    </div>
    <div class="modal-body">
      <div class="radio-group">
        <label class="radio-pill">
          <input type="radio" name="copyFormat" value="both" checked />
          <span>‡¶Ü‡¶∞‡¶¨‡¶ø + ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</span>
        </label>
        <label class="radio-pill">
          <input type="radio" name="copyFormat" value="ar" />
          <span>‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶Ü‡¶∞‡¶¨‡¶ø</span>
        </label>
        <label class="radio-pill">
          <input type="radio" name="copyFormat" value="bn" />
          <span>‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</span>
        </label>
      </div>
      <textarea id="copyPreview" class="copy-preview" placeholder="‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶ø‡¶§ ‡¶Ü‡ßü‡¶æ‡¶§‡ßá‡¶∞ ‡¶≤‡ßá‡¶ñ‡¶æ ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá..."></textarea>
    </div>
    <div class="modal-footer">
      <button id="copyModalCopyBtn" class="btn btn-primary">üìã ‡¶ï‡ßç‡¶≤‡¶ø‡¶™‡¶¨‡ßã‡¶∞‡ßç‡¶°‡ßá ‡¶ï‡¶™‡¶ø</button>
      <button id="copyModalShareBtn" class="btn btn-ghost">üîó ‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    </div>
  </div>
</div>

<!-- Pins / Favs Modal -->
<div id="pinsModal" class="modal-backdrop">
  <div class="modal">
    <div class="modal-header">
      <h2>üìå ‡¶™‡¶ø‡¶® ‡¶ì ‚≠ê ‡¶´‡ßá‡¶≠‡¶æ‡¶∞‡¶ø‡¶ü</h2>
      <button class="close-btn" data-close-modal="pinsModal">‡¶¨‡¶®‡ßç‡¶ß</button>
    </div>
    <div class="modal-body" style="display:flex;flex-direction:column;gap:8px;">
      <div class="radio-group">
        <label class="radio-pill">
          <input type="radio" name="pinsTab" value="pins" checked />
          <span>üìå ‡¶™‡¶ø‡¶® ‡¶ï‡¶∞‡¶æ ‡¶Ü‡ßü‡¶æ‡¶§</span>
        </label>
        <label class="radio-pill">
          <input type="radio" name="pinsTab" value="favs" />
          <span>‚≠ê ‡¶´‡ßá‡¶≠‡¶æ‡¶∞‡¶ø‡¶ü ‡¶Ü‡ßü‡¶æ‡¶§</span>
        </label>
      </div>
      <div class="sidebar-search" style="margin-bottom:4px;">
        <span class="sidebar-search-icon">üîç</span>
        <input id="pinsSearchInput" type="text" placeholder="‡¶∏‡ßÅ‡¶∞‡¶æ / ‡¶∂‡¶¨‡ßç‡¶¶ ‡¶¶‡¶ø‡ßü‡ßá ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞..." style="background:white;color:#0f172a;border-color:#e5e7eb;">
      </div>
      <div style="font-size:12px;display:flex;gap:6px;align-items:center;">
        <span>‡¶∏‡¶æ‡¶ú‡¶æ‡¶®‡ßã:</span>
        <span class="chip active" data-sort="recent">‡¶∏‡¶∞‡ßç‡¶¨‡¶∂‡ßá‡¶∑ ‡¶Ü‡¶ó‡ßá</span>
        <span class="chip" data-sort="sura">‡¶∏‡ßÇ‡¶∞‡¶æ-‡¶Ü‡ßü‡¶æ‡¶§ ‡¶ï‡ßç‡¶∞‡¶Æ</span>
        <button id="clearAllPinsFavsBtn" class="close-btn" style="margin-left:auto;background:var(--danger-soft);color:var(--danger);border-color:#fecaca;">‡¶∏‡¶¨ ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>
      </div>
      <div id="pinsListContainer" style="max-height:55vh;overflow-y:auto;margin-top:4px;"></div>
    </div>
  </div>
</div>

<!-- Load suras.js -->
<script src="suras.js"></script>

<script>
(function() {
  if (typeof suras === "undefined" || !Array.isArray(suras)) {
    console.error("‚ùå suras.js not loaded or suras is not an array.");
    document.getElementById("currentSuraName").textContent =
      "‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: suras.js ‡¶´‡¶æ‡¶á‡¶≤ ‡¶≤‡ßã‡¶° ‡¶π‡ßü‡¶®‡¶ø ‡¶¨‡¶æ ‡¶≠‡ßç‡¶Ø‡¶æ‡¶∞‡¶ø‡ßü‡ßá‡¶¨‡¶≤ 'suras' ‡¶∏‡¶†‡¶ø‡¶ï ‡¶®‡ßá‡¶á‡•§";
    document.getElementById("ayaList").innerHTML =
      '<div style="padding:12px;font-size:13px;color:#b91c1c;">suras.js ‡¶´‡¶æ‡¶á‡¶≤‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ/‡¶™‡¶æ‡¶• ‡¶ì ‡¶≠‡ßç‡¶Ø‡¶æ‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶¨‡¶≤ ‡¶®‡¶æ‡¶Æ (suras) ‡¶†‡¶ø‡¶ï ‡¶Ü‡¶õ‡ßá ‡¶ï‡¶ø‡¶®‡¶æ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</div>';
    return;
  }

  let currentSuraIndex = 0;
  let currentView = localStorage.getItem("q_view") || "both";
  let fontSize = parseInt(localStorage.getItem("q_fontSize") || "18", 10);
  let lineHeight = parseFloat(localStorage.getItem("q_lineHeight") || "1.7");
  let selectedAyaat = new Set();

  let lastRead = loadLastRead();
  let pins = loadPinsFavs("q_pins");
  let favs = loadPinsFavs("q_favs");

  function loadLastRead() {
    try { const r = localStorage.getItem("q_lastRead"); return r ? JSON.parse(r) : null; } catch(e){ return null; }
  }
  function saveLastRead(obj) {
    lastRead = obj;
    localStorage.setItem("q_lastRead", JSON.stringify(obj));
    renderLastRead();
  }
  function loadPinsFavs(key) {
    try { const r = localStorage.getItem(key); return r ? JSON.parse(r) : []; } catch(e){ return []; }
  }
  function savePinsFavs(key, arr) {
    localStorage.setItem(key, JSON.stringify(arr));
  }
  function ayahKey(sIdx,aIdx){ return sIdx+":"+aIdx; }

  const sidebarSuraListEl = document.getElementById("sidebarSuraList");
  const sidebarSuraSearchEl = document.getElementById("sidebarSuraSearch");
  const modalSuraListEl = document.getElementById("modalSuraList");
  const modalSuraSearchEl = document.getElementById("modalSuraSearch");

  function renderSuraList(filter="") {
    const ft = filter.trim().toLowerCase();
    const list = suras.map((s,idx)=>{
      const bn=s.name_bn||s.name||"", ar=s.name_ar||"", id=(idx+1).toString();
      const hit=!ft || bn.toLowerCase().includes(ft) || ar.toLowerCase().includes(ft) || id===ft;
      return hit?{s,idx}:null;
    }).filter(Boolean);

    function buildList(target,isModal){
      target.innerHTML="";
      list.forEach(({s,idx})=>{
        const div=document.createElement("div");
        div.className="sura-item"+(idx===currentSuraIndex?" active":"");
        div.dataset.suraIndex=idx;
        const left=document.createElement("div");
        left.className="sura-item-left";
        const title=document.createElement("div");
        title.className="sura-item-title";
        title.textContent=(idx+1)+". "+(bn=s.name_bn||s.name);
        const meta=document.createElement("div");
        meta.className="sura-item-meta";
        meta.textContent=(s.aya_count||(s.ayas?s.ayas.length:"?"))+" ‡¶Ü‡ßü‡¶æ‡¶§";
        left.appendChild(title); left.appendChild(meta);
        const right=document.createElement("div");
        right.className="sura-item-right";
        right.textContent=s.name_ar||"";
        div.appendChild(left); div.appendChild(right);
        div.addEventListener("click",()=>{
          setCurrentSura(idx);
          if(isModal) closeModal("suraListModal");
        });
        target.appendChild(div);
      });
    }
    buildList(sidebarSuraListEl,false);
    if(modalSuraListEl) buildList(modalSuraListEl,true);
  }

  sidebarSuraSearchEl.addEventListener("input",()=>renderSuraList(sidebarSuraSearchEl.value));
  if(modalSuraSearchEl){
    modalSuraSearchEl.addEventListener("input",()=>renderSuraList(modalSuraSearchEl.value));
  }

  const currentSuraNameEl=document.getElementById("currentSuraName");
  const currentSuraStatsEl=document.getElementById("currentSuraStats");
  const ayaListEl=document.getElementById("ayaList");
  const ayaCountLabelEl=document.getElementById("ayaCountLabel");
  const multiSelectBarEl=document.getElementById("multiSelectBar");
  const multiSelectCountEl=document.getElementById("multiSelectCount");

  function setCurrentSura(idx){
    currentSuraIndex=idx;
    selectedAyaat.clear();
    updateMultiSelectBar();

    const s=suras[idx];
    const totalAyat=(s.ayas||s.ayat||s.verses||[]).length;
    currentSuraNameEl.innerHTML =
      (idx+1)+". "+(s.name_bn||s.name)+' <span class="ar">('+ (s.name_ar||"") +')</span>';
    currentSuraStatsEl.textContent = totalAyat+"‡¶ü‡¶ø ‡¶Ü‡ßü‡¶æ‡¶§ ¬∑ ‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶®‡ßã‡¶ü‡¶∏ / ‡¶ï‡¶™‡¶ø / ‡¶∂‡ßá‡ßü‡¶æ‡¶∞";

    renderSuraList(sidebarSuraSearchEl.value||"");
    renderAyaList();
  }

  function renderAyaList(){
    const s=suras[currentSuraIndex];
    const ayas=s.ayas||s.ayat||s.verses||[];
    ayaListEl.innerHTML="";
    const count=ayas.length;
    ayaCountLabelEl.textContent=count+" ‡¶ü‡¶ø ‡¶Ü‡ßü‡¶æ‡¶§";

    ayas.forEach((aya,idx)=>{
      const row=document.createElement("div");
      row.className="aya-row";
      row.id="aya-"+currentSuraIndex+"-"+idx;

      const selectCol=document.createElement("div");
      selectCol.className="aya-select";
      const cb=document.createElement("input");
      cb.type="checkbox";
      const key=ayahKey(currentSuraIndex,idx);
      cb.checked=selectedAyaat.has(key);
      cb.addEventListener("change",()=>{
        if(cb.checked) selectedAyaat.add(key); else selectedAyaat.delete(key);
        updateMultiSelectBar();
      });
      selectCol.appendChild(cb);

      const textCol=document.createElement("div");
      textCol.className="aya-text";
      textCol.style.fontSize=fontSize+"px";
      textCol.style.lineHeight=lineHeight;

      const meta=document.createElement("div");
      meta.className="aya-meta";
      const number=document.createElement("span");
      number.className="aya-number-pill";
      number.textContent=(currentSuraIndex+1)+":"+ (idx+1);
      const tags=document.createElement("div");
      tags.className="aya-tags";
      if(isPinned(currentSuraIndex,idx)){
        const t=document.createElement("div");
        t.className="tag-pill pin";
        t.innerHTML="üìå <span>‡¶™‡¶ø‡¶®</span>";
        tags.appendChild(t);
      }
      if(isFav(currentSuraIndex,idx)){
        const t=document.createElement("div");
        t.className="tag-pill fav";
        t.innerHTML="‚≠ê <span>‡¶´‡ßá‡¶≠‡¶æ‡¶∞‡¶ø‡¶ü</span>";
        tags.appendChild(t);
      }
      meta.appendChild(number); meta.appendChild(tags);

      const arEl=document.createElement("div");
      arEl.className="aya-arabic";
      arEl.textContent=aya.ar||aya.arabic||aya.text_ar||"";

      const bnEl=document.createElement("div");
      bnEl.className="aya-bangla";
      bnEl.textContent=aya.bn||aya.bangla||aya.text_bn||"";

      if(currentView==="both"){
        arEl.style.display=""; bnEl.style.display="";
      } else if(currentView==="ar"){
        arEl.style.display=""; bnEl.style.display="none";
      } else {
        arEl.style.display="none"; bnEl.style.display="";
      }

      textCol.appendChild(meta);
      textCol.appendChild(arEl);
      textCol.appendChild(bnEl);

      const actionsCol=document.createElement("div");
      actionsCol.className="aya-actions";

      const topRow=document.createElement("div");
      topRow.className="aya-actions-top";

      const pinBtn=document.createElement("button");
      pinBtn.className="icon-chip";
      pinBtn.innerHTML='<span class="icon">üìå</span><span>‡¶™‡¶ø‡¶®</span>';
      if(isPinned(currentSuraIndex,idx)) pinBtn.classList.add("pin-active");
      pinBtn.addEventListener("click",()=>{
        togglePin(currentSuraIndex,idx);
        renderAyaList();
        renderPinsSidebar();
      });

      const favBtn=document.createElement("button");
      favBtn.className="icon-chip";
      favBtn.innerHTML='<span class="icon">‚≠ê</span><span>‡¶´‡ßá‡¶≠‡¶æ‡¶∞‡¶ø‡¶ü</span>';
      if(isFav(currentSuraIndex,idx)) favBtn.classList.add("fav-active");
      favBtn.addEventListener("click",()=>{
        toggleFav(currentSuraIndex,idx);
        renderAyaList();
        renderPinsSidebar();
      });

      const copyBtn=document.createElement("button");
      copyBtn.className="icon-chip";
      copyBtn.innerHTML='<span class="icon">üìã</span>';
      copyBtn.title="‡¶è‡¶á ‡¶Ü‡ßü‡¶æ‡¶§ ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®";
      copyBtn.addEventListener("click",()=>{
        const text=formatAyaForCopy(currentSuraIndex,idx,getCopyFormat());
        navigator.clipboard.writeText(text).then(()=>alert("‡¶Ü‡ßü‡¶æ‡¶§ ‡¶ï‡¶™‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§"));
      });

      const shareBtn=document.createElement("button");
      shareBtn.className="icon-chip";
      shareBtn.innerHTML='<span class="icon">üîó</span>';
      shareBtn.title="‡¶è‡¶á ‡¶Ü‡ßü‡¶æ‡¶§ ‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®";
      shareBtn.addEventListener("click",()=>{
        const text=formatAyaForCopy(currentSuraIndex,idx,getCopyFormat());
        doShare(text);
      });

      const lastBtn=document.createElement("button");
      lastBtn.className="icon-chip main";
      lastBtn.innerHTML='<span class="icon">‚è±</span><span>‡¶∂‡ßá‡¶∑ ‡¶™‡ßú‡¶æ</span>';
      lastBtn.addEventListener("click",()=>{
        saveLastRead({suraIndex:currentSuraIndex,ayaIndex:idx,time:Date.now()});
        alert("‡¶è‡¶á ‡¶Ü‡ßü‡¶æ‡¶§‡¶ï‡ßá ‡¶∏‡¶∞‡ßç‡¶¨‡¶∂‡ßá‡¶∑ ‡¶™‡ßú‡¶æ ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§");
      });

      topRow.appendChild(pinBtn);
      topRow.appendChild(favBtn);
      topRow.appendChild(copyBtn);
      topRow.appendChild(shareBtn);

      const bottomRow=document.createElement("div");
      bottomRow.className="aya-actions-bottom";
      bottomRow.innerHTML="‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶è‡¶ï‡ßç‡¶∏‡ßá‡¶∏‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®";

      actionsCol.appendChild(topRow);
      actionsCol.appendChild(lastBtn);
      actionsCol.appendChild(bottomRow);

      row.appendChild(selectCol);
      row.appendChild(textCol);
      row.appendChild(actionsCol);

      ayaListEl.appendChild(row);
    });

    updateMultiSelectBar();
  }

  function updateMultiSelectBar(){
    const count=selectedAyaat.size;
    if(count>0){
      multiSelectBarEl.classList.add("active");
      multiSelectCountEl.textContent=count+" ‡¶ü‡¶ø ‡¶Ü‡ßü‡¶æ‡¶§ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶ø‡¶§";
    } else {
      multiSelectBarEl.classList.remove("active");
    }
  }

  function isPinned(sIdx,aIdx){
    const key=ayahKey(sIdx,aIdx);
    return pins.some(p=>p.key===key);
  }
  function isFav(sIdx,aIdx){
    const key=ayahKey(sIdx,aIdx);
    return favs.some(p=>p.key===key);
  }
  function togglePin(sIdx,aIdx){
    const key=ayahKey(sIdx,aIdx);
    const i=pins.findIndex(p=>p.key===key);
    if(i>=0) pins.splice(i,1);
    else pins.unshift({key,suraIndex:sIdx,ayaIndex:aIdx,type:"pin",note:"",time:Date.now()});
    savePinsFavs("q_pins",pins);
  }
  function toggleFav(sIdx,aIdx){
    const key=ayahKey(sIdx,aIdx);
    const i=favs.findIndex(p=>p.key===key);
    if(i>=0) favs.splice(i,1);
    else favs.unshift({key,suraIndex:sIdx,ayaIndex:aIdx,type:"fav",note:"",time:Date.now()});
    savePinsFavs("q_favs",favs);
  }

  const sidebarPinsFavsEl=document.getElementById("sidebarPinsFavs");
  function renderPinsSidebar(){
    sidebarPinsFavsEl.innerHTML="";
    const combined=[
      ...pins.map(p=>({...p,kind:"pin"})),
      ...favs.map(p=>({...p,kind:"fav"})),
    ].sort((a,b)=>b.time-a.time).slice(0,15);

    if(combined.length===0){
      sidebarPinsFavsEl.innerHTML='<div style="font-size:11px;opacity:.8;">‡¶è‡¶ñ‡¶®‡¶ì ‡¶ï‡ßã‡¶®‡ßã ‡¶Ü‡ßü‡¶æ‡¶§ ‡¶™‡¶ø‡¶® / ‡¶´‡ßá‡¶≠‡¶æ‡¶∞‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡¶®‡¶ø‡•§</div>';
      return;
    }

    combined.forEach(item=>{
      const s=suras[item.suraIndex]; if(!s) return;
      const ayas=s.ayas||s.ayat||s.verses||[];
      const aya=ayas[item.ayaIndex]||{};
      const wrap=document.createElement("div");
      wrap.className="sidebar-mini-item";

      const main=document.createElement("div");
      main.className="sidebar-mini-main";
      main.innerHTML =
        '<strong>'+(item.kind==="pin"?"üìå ":"‚≠ê ")+
        (item.suraIndex+1)+":"+ (item.ayaIndex+1)+'</strong>'+
        '<small>'+(s.name_bn||s.name)+'</small>';

      const actions=document.createElement("div");
      actions.className="sidebar-mini-actions";
      const goBtn=document.createElement("button");
      goBtn.textContent="‡¶Ø‡¶æ‡¶®";
      goBtn.addEventListener("click",()=>{
        setCurrentSura(item.suraIndex);
        setTimeout(()=>{
          const el=document.getElementById("aya-"+item.suraIndex+"-"+item.ayaIndex);
          if(el) el.scrollIntoView({behavior:"smooth",block:"center"});
        },120);
      });
      actions.appendChild(goBtn);

      wrap.appendChild(main); wrap.appendChild(actions);
      sidebarPinsFavsEl.appendChild(wrap);
    });
  }

  const lastReadBoxEl=document.getElementById("lastReadBox");
  const clearLastReadBtn=document.getElementById("clearLastReadBtn");

  function renderLastRead(){
    if(!lastRead){
      lastReadBoxEl.innerHTML="‡¶è‡¶ñ‡¶®‡ßã ‡¶ï‡ßã‡¶®‡ßã ‡¶Ü‡ßü‡¶æ‡¶§‡¶ï‡ßá ‡¶∏‡¶∞‡ßç‡¶¨‡¶∂‡ßá‡¶∑ ‡¶™‡ßú‡¶æ ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡¶®‡¶ø‡•§";
      return;
    }
    const s=suras[lastRead.suraIndex];
    if(!s){ lastReadBoxEl.innerHTML="‡¶∏‡¶∞‡ßç‡¶¨‡¶∂‡ßá‡¶∑ ‡¶™‡ßú‡¶æ ‡¶°‡¶æ‡¶ü‡¶æ‡ßü ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶∞‡ßü‡ßá‡¶õ‡ßá‡•§"; return; }
    const ayas=s.ayas||s.ayat||s.verses||[];
    const aya=ayas[lastRead.ayaIndex]||{};
    lastReadBoxEl.innerHTML=
      '<div><strong>'+ (lastRead.suraIndex+1)+":"+(lastRead.ayaIndex+1) +
      '</strong> - '+ (s.name_bn||s.name) +'</div>'+
      '<div class="last-read-preview">'+
      ( (aya.bn||aya.bangla||"").slice(0,65) )+'...</div>'+
      '<div class="last-read-actions">'+
      '<button class="btn-last-read-go" id="goLastReadBtn">‚è± ‡¶è‡¶ñ‡¶æ‡¶® ‡¶•‡ßá‡¶ï‡ßá ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®</button>'+
      '<button class="btn-last-read-clear">‡¶∞‡¶ø‡¶∏‡ßá‡¶ü</button>'+
      '</div>';
    const goBtn=document.getElementById("goLastReadBtn");
    if(goBtn){
      goBtn.addEventListener("click",()=>{
        setCurrentSura(lastRead.suraIndex);
        setTimeout(()=>{
          const el=document.getElementById("aya-"+lastRead.suraIndex+"-"+lastRead.ayaIndex);
          if(el) el.scrollIntoView({behavior:"smooth",block:"center"});
        },120);
      });
    }
    const resetBtn=lastReadBoxEl.querySelector(".btn-last-read-clear");
    if(resetBtn){
      resetBtn.addEventListener("click",()=>{
        lastRead=null;
        localStorage.removeItem("q_lastRead");
        renderLastRead();
      });
    }
  }

  clearLastReadBtn.addEventListener("click",()=>{
    lastRead=null;
    localStorage.removeItem("q_lastRead");
    renderLastRead();
  });

  function getCopyFormat(){
    const c=document.querySelector('input[name="copyFormat"]:checked');
    return c?c.value:"both";
  }
  function formatAyaForCopy(sIdx,aIdx,mode){
    const s=suras[sIdx];
    const ayas=s.ayas||s.ayat||s.verses||[];
    const aya=ayas[aIdx]||{};
    const num=(sIdx+1)+":"+ (aIdx+1);
    const ar=aya.ar||aya.arabic||aya.text_ar||"";
    const bn=aya.bn||aya.bangla||aya.text_bn||"";
    const lines=[];
    if(mode==="both"){ if(ar) lines.push(ar); if(bn) lines.push(bn); }
    else if(mode==="ar"){ if(ar) lines.push(ar); }
    else { if(bn) lines.push(bn); }
    lines.push("["+num+" - "+(s.name_bn||s.name)+"]");
    return lines.join("\\n");
  }
  function formatMultipleSelectedAyaat(mode){
    const list=Array.from(selectedAyaat).map(k=>{
      const [sIdx,aIdx]=k.split(":").map(Number);
      return {sIdx,aIdx};
    }).sort((a,b)=>a.sIdx!==b.sIdx? a.sIdx-b.sIdx : a.aIdx-b.aIdx);
    const out=[];
    list.forEach(it=>{ out.push(formatAyaForCopy(it.sIdx,it.aIdx,mode)); out.push(""); });
    return out.join("\\n");
  }
  function doShare(text){
    if(navigator.share){
      navigator.share({text}).catch(()=>{});
    }else{
      navigator.clipboard.writeText(text).then(()=>alert("‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶®‡ßá‡¶á, ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§"));
    }
  }

  document.getElementById("multiCopyBtn").addEventListener("click",()=>{
    if(!selectedAyaat.size) return;
    const text=formatMultipleSelectedAyaat(getCopyFormat());
    document.getElementById("copyPreview").value=text;
    openModal("copyModal");
    navigator.clipboard.writeText(text).catch(()=>{});
  });
  document.getElementById("multiShareBtn").addEventListener("click",()=>{
    if(!selectedAyaat.size) return;
    const text=formatMultipleSelectedAyaat(getCopyFormat());
    doShare(text);
  });
  document.getElementById("multiClearBtn").addEventListener("click",()=>{
    selectedAyaat.clear();
    renderAyaList();
  });

  const copyPreviewEl=document.getElementById("copyPreview");
  document.getElementById("copyModalCopyBtn").addEventListener("click",()=>{
    navigator.clipboard.writeText(copyPreviewEl.value||"").then(()=>alert("‡¶ï‡ßç‡¶≤‡¶ø‡¶™‡¶¨‡ßã‡¶∞‡ßç‡¶°‡ßá ‡¶ï‡¶™‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§"));
  });
  document.getElementById("copyModalShareBtn").addEventListener("click",()=>{
    doShare(copyPreviewEl.value||"");
  });

  const pinsSearchInputEl=document.getElementById("pinsSearchInput");
  const pinsListContainerEl=document.getElementById("pinsListContainer");
  const clearAllPinsFavsBtn=document.getElementById("clearAllPinsFavsBtn");

  function renderPinsModalList(){
    const tab=document.querySelector('input[name="pinsTab"]:checked').value;
    const sortChip=document.querySelector('#pinsModal .chip.active[data-sort]');
    const sortMode=sortChip?sortChip.dataset.sort:"recent";
    const ft=(pinsSearchInputEl.value||"").trim().toLowerCase();

    let list=(tab==="pins"?pins:favs).slice();
    if(sortMode==="recent") list.sort((a,b)=>b.time-a.time);
    else list.sort((a,b)=>a.suraIndex!==b.suraIndex?a.suraIndex-b.suraIndex:a.ayaIndex-b.ayaIndex);

    list=list.filter(item=>{
      const s=suras[item.suraIndex]; if(!s) return false;
      const ayas=s.ayas||s.ayat||s.verses||[];
      const aya=ayas[item.ayaIndex]||{};
      const text=(s.name_bn||s.name||"")+" "+
                 (s.name_ar||"")+" "+
                 (aya.bn||aya.bangla||"")+" "+
                 (item.note||"");
      return !ft || text.toLowerCase().includes(ft);
    });

    pinsListContainerEl.innerHTML="";
    if(!list.length){
      pinsListContainerEl.innerHTML='<div style="font-size:13px;opacity:.7;padding:6px;">‡¶ï‡ßã‡¶®‡ßã ‡¶°‡¶æ‡¶ü‡¶æ ‡¶®‡ßá‡¶á‡•§</div>';
      return;
    }

    list.forEach(item=>{
      const s=suras[item.suraIndex]; if(!s) return;
      const ayas=s.ayas||s.ayat||s.verses||[];
      const aya=ayas[item.ayaIndex]||{};

      const wrap=document.createElement("div");
      const row1=document.createElement("div");
      row1.style.display="flex";
      row1.style.justifyContent="space-between";
      row1.style.alignItems="center";
      row1.style.fontSize="13px";

      const left=document.createElement("div");
      left.innerHTML='<strong>'+(item.kind==="pin"?"üìå ":"‚≠ê ")+
        (item.suraIndex+1)+":"+ (item.ayaIndex+1)+'</strong> - '+(s.name_bn||s.name);

      const right=document.createElement("div");
      right.style.display="flex"; right.style.gap="4px";

      const goBtn=document.createElement("button");
      goBtn.className="close-btn";
      goBtn.textContent="‡¶Ø‡¶æ‡¶®";
      goBtn.addEventListener("click",()=>{
        setCurrentSura(item.suraIndex);
        closeModal("pinsModal");
        setTimeout(()=>{
          const el=document.getElementById("aya-"+item.suraIndex+"-"+item.ayaIndex);
          if(el) el.scrollIntoView({behavior:"smooth",block:"center"});
        },120);
      });

      const cpBtn=document.createElement("button");
      cpBtn.className="close-btn";
      cpBtn.textContent="üìã";
      cpBtn.addEventListener("click",()=>{
        const text=formatAyaForCopy(item.suraIndex,item.ayaIndex,getCopyFormat());
        navigator.clipboard.writeText(text).then(()=>alert("‡¶ï‡¶™‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§"));
      });

      const delBtn=document.createElement("button");
      delBtn.className="close-btn";
      delBtn.style.background="#fee2e2";
      delBtn.style.color="#b91c1c";
      delBtn.textContent="üóë";
      delBtn.addEventListener("click",()=>{
        if(tab==="pins"){ pins=pins.filter(p=>p.key!==item.key); savePinsFavs("q_pins",pins); }
        else { favs=favs.filter(p=>p.key!==item.key); savePinsFavs("q_favs",favs); }
        renderPinsModalList();
        renderPinsSidebar();
        renderAyaList();
      });

      right.appendChild(goBtn); right.appendChild(cpBtn); right.appendChild(delBtn);
      row1.appendChild(left); row1.appendChild(right);

      const row2=document.createElement("div");
      row2.style.fontSize="12px"; row2.style.opacity=0.85;
      row2.style.marginTop="4px";
      row2.textContent=(aya.bn||aya.bangla||"").slice(0,90)+"...";

      wrap.appendChild(row1); wrap.appendChild(row2);
      pinsListContainerEl.appendChild(wrap);
    });
  }

  pinsSearchInputEl.addEventListener("input",renderPinsModalList);
  document.querySelectorAll('input[name="pinsTab"]').forEach(r=>r.addEventListener("change",renderPinsModalList));
  document.querySelectorAll('#pinsModal .chip[data-sort]').forEach(ch=>{
    ch.addEventListener("click",()=>{
      document.querySelectorAll('#pinsModal .chip[data-sort]').forEach(c=>c.classList.remove("active"));
      ch.classList.add("active");
      renderPinsModalList();
    });
  });
  clearAllPinsFavsBtn.addEventListener("click",()=>{
    if(!confirm("‡¶∏‡¶¨ ‡¶™‡¶ø‡¶® ‡¶ì ‡¶´‡ßá‡¶≠‡¶æ‡¶∞‡¶ø‡¶ü ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®?")) return;
    pins=[]; favs=[];
    savePinsFavs("q_pins",pins); savePinsFavs("q_favs",favs);
    renderPinsModalList(); renderPinsSidebar(); renderAyaList();
  });

  const viewToggleEl=document.getElementById("viewToggle");
  const fontSizeRangeEl=document.getElementById("fontSizeRange");
  const settingsFontSizeRangeEl=document.getElementById("settingsFontSizeRange");
  const settingsViewChipsEl=document.getElementById("settingsViewChips");
  const lineHeightChipsEl=document.getElementById("lineHeightChips");

  function applyView(){
    localStorage.setItem("q_view",currentView);
    viewToggleEl.querySelectorAll("button").forEach(btn=>{
      btn.classList.toggle("active",btn.dataset.view===currentView);
    });
    settingsViewChipsEl.querySelectorAll(".chip").forEach(ch=>{
      ch.classList.toggle("active",ch.dataset.view===currentView);
    });
    renderAyaList();
  }
  function applyFontSize(){
    localStorage.setItem("q_fontSize",String(fontSize));
    fontSizeRangeEl.value=String(fontSize);
    settingsFontSizeRangeEl.value=String(fontSize);
    renderAyaList();
  }
  function applyLineHeight(){
    localStorage.setItem("q_lineHeight",String(lineHeight));
    lineHeightChipsEl.querySelectorAll(".chip").forEach(ch=>{
      ch.classList.toggle("active",parseFloat(ch.dataset.lh)===lineHeight);
    });
    renderAyaList();
  }

  viewToggleEl.querySelectorAll("button").forEach(btn=>{
    btn.addEventListener("click",()=>{ currentView=btn.dataset.view; applyView(); });
  });
  settingsViewChipsEl.querySelectorAll(".chip").forEach(ch=>{
    ch.addEventListener("click",()=>{ currentView=ch.dataset.view; applyView(); });
  });
  fontSizeRangeEl.addEventListener("input",()=>{ fontSize=parseInt(fontSizeRangeEl.value,10); applyFontSize(); });
  settingsFontSizeRangeEl.addEventListener("input",()=>{ fontSize=parseInt(settingsFontSizeRangeEl.value,10); applyFontSize(); });
  lineHeightChipsEl.querySelectorAll(".chip").forEach(ch=>{
    ch.addEventListener("click",()=>{ lineHeight=parseFloat(ch.dataset.lh); applyLineHeight(); });
  });

  function openModal(id){ const el=document.getElementById(id); if(el) el.classList.add("active"); }
  function closeModal(id){ const el=document.getElementById(id); if(el) el.classList.remove("active"); }

  document.querySelectorAll(".close-btn[data-close-modal]").forEach(btn=>{
    btn.addEventListener("click",()=>closeModal(btn.dataset.closeModal));
  });
  document.getElementById("openSuraListModalBtn").addEventListener("click",()=>openModal("suraListModal"));
  document.getElementById("openSettingsModalBtn").addEventListener("click",()=>openModal("settingsModal"));
  document.getElementById("openCopyModalBtn").addEventListener("click",()=>openModal("copyModal"));
  document.getElementById("openPinsModalBtn").addEventListener("click",()=>{ renderPinsModalList(); openModal("pinsModal"); });
  document.getElementById("floatingSettingsBtn").addEventListener("click",()=>openModal("settingsModal"));

  applyView();
  applyFontSize();
  applyLineHeight();
  renderSuraList();
  setCurrentSura(0);
  renderLastRead();
  renderPinsSidebar();
})();
</script>

</body>
</html>
