<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <title>Al-Qur'an ‚Äî Word by Word</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg-main: #05060a;
      --bg-card: #10121a;
      --bg-card-soft: #141722;
      --bg-topbar: #05060a;
      --accent: #00c6ff;
      --accent-soft: rgba(0, 198, 255, 0.15);
      --border-soft: rgba(255, 255, 255, 0.06);
      --text-main: #ffffff;
      --text-muted: #a8b0c4;
      --text-soft: #7f8597;

      /* default font sizes (rem) */
      --font-ar: 2.0;
      --font-bn: 1.0;
      --font-notes: 1.02;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: radial-gradient(circle at top, #141b2c 0, #05060a 45%, #020308 100%);
      color: var(--text-main);
      min-height: 100vh;
    }

    /* Overall Layout */
    .app-shell {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    /* Sticky Top Bar */
    .top-bar {
      position: sticky;
      top: 0;
      z-index: 100;
      background: rgba(5, 6, 10, 0.98);
      backdrop-filter: blur(16px);
      border-bottom: 1px solid var(--border-soft);
      padding: 0.6rem 0.9rem;
      display: flex;
      align-items: center;
      gap: 0.6rem;
    }

    .top-left {
      display: flex;
      flex-direction: column;
      gap: 0.1rem;
      flex: 1;
      min-width: 0;
    }

    .app-title {
      font-size: 0.9rem;
      font-weight: 600;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      color: #e2e8ff;
      display: flex;
      align-items: center;
      gap: 0.35rem;
    }

    .app-title span.logo {
      width: 18px;
      height: 18px;
      border-radius: 6px;
      border: 1px solid rgba(0, 198, 255, 0.4);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      background: radial-gradient(circle at 30% 0%, #00c6ff 0, #0a0c18 55%, #020308 100%);
      box-shadow: 0 0 8px rgba(0, 198, 255, 0.35);
    }

    .sura-subtitle {
      font-size: 0.75rem;
      color: var(--text-muted);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .sura-subtitle strong {
      color: #f4f4ff;
      font-weight: 600;
    }

    .top-right {
      display: flex;
      align-items: center;
      gap: 0.35rem;
    }

    .icon-btn {
      border: 1px solid rgba(255, 255, 255, 0.14);
      background: linear-gradient(145deg, #161927, #121422);
      color: #e5ecff;
      border-radius: 999px;
      font-size: 0.8rem;
      padding: 0.25rem 0.55rem;
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      cursor: pointer;
      box-shadow: 0 0 12px rgba(0, 0, 0, 0.5);
      transition: all 0.15s ease-out;
    }

    .icon-btn span.icon {
      font-size: 1rem;
      display: inline-flex;
      align-items: center;
    }

    .icon-btn span.label {
      font-size: 0.7rem;
      letter-spacing: 0.03em;
      text-transform: uppercase;
    }

    .icon-btn:hover {
      border-color: rgba(0, 198, 255, 0.6);
      box-shadow: 0 0 16px rgba(0, 198, 255, 0.35);
      transform: translateY(-0.5px);
    }

    .icon-btn.primary {
      background: linear-gradient(135deg, #00c6ff, #0072ff);
      color: #020309;
      border-color: rgba(255, 255, 255, 0.22);
    }

    .icon-btn.primary span.label {
      color: #020309;
    }

    /* Content Area */
    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 0.8rem 0.8rem 4.2rem; /* bottom padding so word bar overlaps ‡¶®‡¶æ ‡¶π‡ßü */
      max-width: 900px;
      margin: 0 auto;
      width: 100%;
    }

    /* Sura List */
    .sura-list {
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
      margin-top: 0.4rem;
    }

    .section-title {
      font-size: 0.9rem;
      font-weight: 600;
      color: #e0e7ff;
      margin-bottom: 0.25rem;
    }

    .sura-card {
      border-radius: 0.9rem;
      padding: 0.65rem 0.75rem;
      border: 1px solid var(--border-soft);
      background: linear-gradient(135deg, rgba(20, 23, 34, 0.96), rgba(10, 12, 22, 0.98));
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.5rem;
      transition: all 0.15s ease-out;
    }

    .sura-card:hover {
      border-color: rgba(0, 198, 255, 0.55);
      box-shadow: 0 0 16px rgba(0, 198, 255, 0.32);
      transform: translateY(-1px);
    }

    .sura-meta {
      display: flex;
      flex-direction: column;
      gap: 0.12rem;
    }

    .sura-meta .bn {
      font-size: 0.9rem;
      font-weight: 600;
      color: #f4f4ff;
    }

    .sura-meta .ar {
      font-size: 1rem;
      direction: rtl;
      text-align: right;
    }

    .sura-meta .info {
      font-size: 0.7rem;
      color: var(--text-soft);
    }

    .sura-number-badge {
      min-width: 28px;
      height: 28px;
      border-radius: 999px;
      border: 1px solid rgba(0, 198, 255, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.85rem;
      font-weight: 600;
      color: #e8f6ff;
      background: radial-gradient(circle at 30% 0, #00c6ff 0, #020308 70%);
      box-shadow: 0 0 10px rgba(0, 198, 255, 0.5);
    }

    /* Bismillah */
    .bismillah-card {
      border-radius: 1rem;
      padding: 0.75rem 0.8rem 0.85rem;
      border: 1px solid rgba(0, 198, 255, 0.35);
      background: radial-gradient(circle at top, rgba(0, 198, 255, 0.18) 0, #090b14 42%, #05060c 100%);
      margin-bottom: 0.8rem;
      margin-top: 0.4rem;
    }

    .bismillah-ar {
      font-size: calc(var(--font-ar) * 0.92rem);
      direction: rtl;
      text-align: center;
      margin-bottom: 0.35rem;
      line-height: 1.7;
    }

    .bismillah-bn {
      font-size: calc(var(--font-bn) * 0.85rem);
      text-align: center;
      color: var(--text-muted);
    }

    /* Ayah Cards */
    .ayah-list {
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
    }

    .ayah-card {
      border-radius: 0.85rem;
      padding: 0.65rem 0.7rem;
      border: 1px solid var(--border-soft);
      background: linear-gradient(145deg, rgba(16, 18, 30, 0.98), rgba(9, 11, 20, 0.98));
    }

    .ayah-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.4rem;
      margin-bottom: 0.35rem;
    }

    .ayah-label {
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .ayah-number-circle {
      min-width: 26px;
      height: 26px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.22);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      color: #e5ecff;
      background: radial-gradient(circle at 30% 0, #1b2338 0, #05060a 70%);
    }

    .ayah-ar-text {
      font-size: calc(var(--font-ar) * 1rem);
      line-height: 1.9;
      direction: rtl;
      text-align: right;
      margin-bottom: 0.35rem;
    }

    .ayah-bn-text {
      font-size: calc(var(--font-bn) * 0.9rem);
      line-height: 1.5;
      color: var(--text-muted);
      margin-top: 0.3rem;
    }

    /* WBW pills */
    .wbw-grid {
      display: flex;
      flex-wrap: wrap;
      justify-content: flex-end;
      row-gap: 0.35rem;
      column-gap: 0.35rem;
      direction: rtl;
      margin-top: 0.2rem;
    }

    .wbw-pill {
      border-radius: 999px;
      padding: 0.25rem 0.55rem;
      border: 1px solid rgba(255, 255, 255, 0.18);
      background: radial-gradient(circle at 20% 0, rgba(0, 198, 255, 0.28) 0, rgba(9, 11, 22, 0.98) 38%, rgba(5, 6, 12, 0.98) 100%);
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 0.05rem;
      transition: all 0.12s ease-out;
      max-width: 45%;
    }

    .wbw-pill:hover {
      border-color: rgba(0, 198, 255, 0.7);
      box-shadow: 0 0 12px rgba(0, 198, 255, 0.45);
      transform: translateY(-0.5px);
    }

    .wbw-ar {
      font-size: calc(var(--font-ar) * 0.9rem);
      direction: rtl;
      text-align: right;
    }

    .wbw-bn {
      font-size: calc(var(--font-bn) * 0.78rem);
      color: var(--text-soft);
      direction: ltr;
      text-align: left;
      width: 100%;
    }

    /* Fixed Word Bar */
    .word-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 90;
      background: radial-gradient(circle at top, #141b2b 0, #05060a 45%, #020205 100%);
      border-top: 1px solid var(--border-soft);
      padding: 0.5rem 0.8rem 0.7rem;
      display: none;
    }

    .word-bar-inner {
      max-width: 900px;
      margin: 0 auto;
      display: flex;
      align-items: flex-start;
      gap: 0.65rem;
    }

    .word-main {
      flex: 1;
      min-width: 0;
    }

    .word-ar-small {
      font-size: calc(var(--font-ar) * 0.75rem);
      direction: rtl;
      text-align: right;
      margin-bottom: 0.15rem;
      color: #e5f3ff;
    }

    .word-bn {
      font-size: calc(var(--font-bn) * 0.87rem);
      text-align: left;
      color: var(--text-main);
      line-height: 1.5;
    }

    .word-bar-grammar-btn {
      align-self: stretch;
      display: flex;
      align-items: center;
    }

    .word-bar-grammar-btn button {
      border-radius: 0.65rem;
      border: 1px solid rgba(0, 198, 255, 0.6);
      background: linear-gradient(135deg, #00c6ff, #0072ff);
      color: #020309;
      font-size: 0.75rem;
      padding: 0.45rem 0.6rem;
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      cursor: pointer;
      box-shadow: 0 0 12px rgba(0, 198, 255, 0.45);
    }

    .word-bar-grammar-btn button span.icon {
      font-size: 0.95rem;
    }

    /* Grammar Modal */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.65);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 120;
      padding: 1.2rem;
    }

    .modal {
      max-width: 640px;
      width: 100%;
      background: radial-gradient(circle at top, #222a3f 0, #05060c 40%, #05060c 100%);
      border-radius: 1rem;
      border: 1px solid rgba(255, 255, 255, 0.16);
      box-shadow: 0 18px 60px rgba(0, 0, 0, 0.8);
      padding: 0.8rem 0.9rem 0.9rem;
      display: flex;
      flex-direction: column;
      gap: 0.55rem;
      max-height: 80vh;
      overflow-y: auto;
    }

    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.5rem;
    }

    .modal-title {
      font-size: 0.9rem;
      font-weight: 600;
      color: #eaf1ff;
      display: flex;
      flex-direction: column;
      gap: 0.2rem;
    }

    .modal-title .small {
      font-size: 0.78rem;
      color: var(--text-soft);
    }

    .modal-close-btn {
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.16);
      background: #121422;
      width: 28px;
      height: 28px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      color: #f4f4ff;
      font-size: 0.9rem;
    }

    .modal-ar {
      font-size: calc(var(--font-ar) * 0.9rem);
      direction: rtl;
      text-align: right;
      padding: 0.45rem 0.55rem;
      border-radius: 0.6rem;
      background: radial-gradient(circle at 20% 0, rgba(0, 198, 255, 0.18) 0, rgba(5, 7, 16, 0.98) 40%);
      border: 1px solid rgba(0, 198, 255, 0.4);
    }

    .modal-notes {
      font-size: calc(var(--font-notes) * 0.85rem);
      line-height: 1.7;
      text-align: left;
      color: #e1e6ff;
      padding: 0.55rem 0.5rem 0.4rem;
      border-radius: 0.7rem;
      background: #0c0f1b;
      border: 1px solid rgba(255, 255, 255, 0.12);
    }

    /* Settings Panel */
    .settings-panel {
      position: fixed;
      top: 0.5rem;
      right: 0.5rem;
      z-index: 130;
      background: radial-gradient(circle at top, #222a3f 0, #05060c 40%, #05060c 100%);
      border-radius: 0.9rem;
      border: 1px solid rgba(255, 255, 255, 0.18);
      padding: 0.6rem 0.7rem;
      box-shadow: 0 18px 60px rgba(0, 0, 0, 0.85);
      min-width: 230px;
      display: none;
    }

    .settings-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.5rem;
      margin-bottom: 0.4rem;
    }

    .settings-title {
      font-size: 0.82rem;
      font-weight: 600;
      color: #eaf1ff;
    }

    .settings-row {
      margin-bottom: 0.45rem;
    }

    .settings-label {
      font-size: 0.75rem;
      color: var(--text-soft);
      margin-bottom: 0.2rem;
    }

    .settings-value {
      font-size: 0.75rem;
      color: #eef2ff;
      margin-top: 0.05rem;
      text-align: right;
    }

    input[type="range"] {
      width: 100%;
    }

    @media (min-width: 768px) {
      .top-bar {
        padding: 0.6rem 1.4rem;
      }

      .main-content {
        padding-left: 1.4rem;
        padding-right: 1.4rem;
      }

      .word-bar {
        padding-left: 1.4rem;
        padding-right: 1.4rem;
      }

      .settings-panel {
        right: 1.4rem;
      }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <!-- TOP BAR -->
    <header class="top-bar">
      <div class="top-left">
        <div class="app-title">
          <span class="logo">Ôªï</span>
          <span>Al-Qur'an</span>
        </div>
        <div class="sura-subtitle" id="suraSubtitle">
          ‡¶∏‡ßÇ‡¶∞‡¶æ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‚Ä¶
        </div>
      </div>
      <div class="top-right">
        <button class="icon-btn primary" id="modeToggleBtn" data-mode="telawat">
          <span class="icon">üìñ</span>
          <span class="label">Telawat</span>
        </button>
        <button class="icon-btn" id="settingsBtn">
          <span class="icon">‚öôÔ∏è</span>
          <span class="label">Settings</span>
        </button>
      </div>
    </header>

    <!-- MAIN CONTENT -->
    <main class="main-content">
      <section id="suraListSection">
        <div class="section-title">‡¶∏‡ßÅ‡¶∞‡¶æ ‡¶¨‡ßá‡¶õ‡ßá ‡¶®‡¶ø‡¶®</div>
        <div class="sura-list" id="suraList">
          <!-- ‡¶è‡¶ñ‡¶® ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶∏‡ßÇ‡¶∞‡¶æ ‡ßß‡ß¶‡ß™, ‡¶™‡¶∞‡ßá ‡ßß‡ßß‡ß™ ‡¶ü‡¶æ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá -->
        </div>
      </section>

      <section id="quranSection" style="display:none;">
        <div id="bismillahBox" class="bismillah-card" style="display:none;">
          <div id="bismillahAr" class="bismillah-ar"></div>
          <div id="bismillahBn" class="bismillah-bn"></div>
        </div>
        <div id="ayahContainer" class="ayah-list"></div>
      </section>
    </main>

    <!-- WORD BAR -->
    <div id="wordBar" class="word-bar">
      <div class="word-bar-inner">
        <div class="word-main">
          <div id="wordBarAr" class="word-ar-small"></div>
          <div id="wordBarBn" class="word-bn"></div>
        </div>
        <div class="word-bar-grammar-btn">
          <button id="wordBarGrammarBtn">
            <span class="icon">‚úèÔ∏è</span>
            <span>Grammar</span>
          </button>
        </div>
      </div>
    </div>

    <!-- GRAMMAR MODAL -->
    <div id="grammarModalBackdrop" class="modal-backdrop">
      <div class="modal">
        <div class="modal-header">
          <div class="modal-title">
            <span>Grammar Notes</span>
            <span class="small" id="grammarModalAyahLabel"></span>
          </div>
          <button class="modal-close-btn" id="grammarModalClose">‚úï</button>
        </div>
        <div id="grammarModalAr" class="modal-ar"></div>
        <div id="grammarModalNotes" class="modal-notes"></div>
      </div>
    </div>

    <!-- SETTINGS PANEL -->
    <div id="settingsPanel" class="settings-panel">
      <div class="settings-header">
        <div class="settings-title">Display Settings</div>
        <button class="modal-close-btn" id="settingsClose">‚úï</button>
      </div>
      <div class="settings-row">
        <div class="settings-label">‡¶Ü‡¶∞‡¶¨‡¶ø ‡¶´‡¶®‡ßç‡¶ü ‡¶∏‡¶æ‡¶á‡¶ú</div>
        <input type="range" id="arFontSlider" min="1.6" max="2.4" step="0.05" value="2.0" />
        <div class="settings-value" id="arFontValue">2.0rem</div>
      </div>
      <div class="settings-row">
        <div class="settings-label">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶´‡¶®‡ßç‡¶ü ‡¶∏‡¶æ‡¶á‡¶ú</div>
        <input type="range" id="bnFontSlider" min="0.9" max="1.3" step="0.05" value="1.0" />
        <div class="settings-value" id="bnFontValue">1.0rem</div>
      </div>
      <div class="settings-row">
        <div class="settings-label">Grammar ‡¶®‡ßã‡¶ü ‡¶´‡¶®‡ßç‡¶ü ‡¶∏‡¶æ‡¶á‡¶ú</div>
        <input type="range" id="notesFontSlider" min="0.9" max="1.2" step="0.03" value="1.02" />
        <div class="settings-value" id="notesFontValue">1.02rem</div>
      </div>
    </div>
  </div>

  <script>
    // --------------------------
    // STATE
    // --------------------------
    const state = {
      currentMode: 'telawat', // 'telawat' | 'wbw'
      currentSurah: null,
      surahData: null,
      lastWordContext: null
    };

    // --------------------------
    // DOM ELEMENTS
    // --------------------------
    const suraListEl = document.getElementById('suraList');
    const suraListSection = document.getElementById('suraListSection');
    const quranSection = document.getElementById('quranSection');
    const suraSubtitle = document.getElementById('suraSubtitle');

    const bismillahBox = document.getElementById('bismillahBox');
    const bismillahAr = document.getElementById('bismillahAr');
    const bismillahBn = document.getElementById('bismillahBn');

    const ayahContainer = document.getElementById('ayahContainer');

    const modeToggleBtn = document.getElementById('modeToggleBtn');
    const settingsBtn = document.getElementById('settingsBtn');
    const settingsPanel = document.getElementById('settingsPanel');
    const settingsClose = document.getElementById('settingsClose');

    // Word bar
    const wordBar = document.getElementById('wordBar');
    const wordBarAr = document.getElementById('wordBarAr');
    const wordBarBn = document.getElementById('wordBarBn');
    const wordBarGrammarBtn = document.getElementById('wordBarGrammarBtn');

    // Grammar modal
    const grammarModalBackdrop = document.getElementById('grammarModalBackdrop');
    const grammarModalClose = document.getElementById('grammarModalClose');
    const grammarModalAyahLabel = document.getElementById('grammarModalAyahLabel');
    const grammarModalAr = document.getElementById('grammarModalAr');
    const grammarModalNotes = document.getElementById('grammarModalNotes');

    // Font sliders
    const arFontSlider = document.getElementById('arFontSlider');
    const bnFontSlider = document.getElementById('bnFontSlider');
    const notesFontSlider = document.getElementById('notesFontSlider');
    const arFontValue = document.getElementById('arFontValue');
    const bnFontValue = document.getElementById('bnFontValue');
    const notesFontValue = document.getElementById('notesFontValue');

    // --------------------------
    // SURAH LIST (static for now)
    // --------------------------
    const surahList = [
      {
        number: 104,
        nameAr: "ÿ≥Ÿàÿ±ÿ© ÿßŸÑŸáŸÖÿ≤ÿ©",
        nameBn: "‡¶∏‡ßÇ‡¶∞‡¶æ ‡¶Ü‡¶≤-‡¶π‡ßÅ‡¶Æ‡¶æ‡¶Ø‡¶æ‡¶π",
        ayahCount: 9,
        file: "surah_104.json"
      }
    ];

    function renderSurahList() {
      suraListEl.innerHTML = '';
      surahList.forEach(s => {
        const card = document.createElement('div');
        card.className = 'sura-card';
        card.addEventListener('click', () => loadSurah(s));

        const meta = document.createElement('div');
        meta.className = 'sura-meta';

        const bn = document.createElement('div');
        bn.className = 'bn';
        bn.textContent = s.nameBn;

        const ar = document.createElement('div');
        ar.className = 'ar';
        ar.textContent = s.nameAr;

        const info = document.createElement('div');
        info.className = 'info';
        info.textContent = `‡¶∏‡ßÇ‡¶∞‡¶æ ‡¶®‡¶Ç ${s.number} ‚Ä¢ ‡¶Ü‡ßü‡¶æ‡¶§ ${s.ayahCount}`;

        meta.appendChild(bn);
        meta.appendChild(ar);
        meta.appendChild(info);

        const badge = document.createElement('div');
        badge.className = 'sura-number-badge';
        badge.textContent = s.number;

        card.appendChild(meta);
        card.appendChild(badge);

        suraListEl.appendChild(card);
      });
    }

    // --------------------------
    // LOAD SURAH
    // --------------------------
    async function loadSurah(surahMeta) {
      try {
        const res = await fetch(surahMeta.file);
        const data = await res.json();

        state.currentSurah = surahMeta;
        state.surahData = data;

        suraListSection.style.display = 'none';
        quranSection.style.display = 'block';

        suraSubtitle.innerHTML =
          `<strong>${surahMeta.nameBn}</strong> (${surahMeta.nameAr}) ‚Äî ‡¶Ü‡ßü‡¶æ‡¶§ ${surahMeta.ayahCount}`;

        // Bismillah
        if (data.hasBismillah && data.bismillah) {
          bismillahBox.style.display = 'block';
          bismillahAr.textContent = data.bismillah.arabic || '';
          bismillahBn.textContent = data.bismillah.bangla || '';
        } else {
          bismillahBox.style.display = 'none';
        }

        renderAyahs();

        // Scroll up a bit after load
        window.scrollTo({ top: 0, behavior: 'smooth' });
      } catch (err) {
        console.error(err);
        alert('‡¶∏‡ßÅ‡¶∞‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§ ‡¶´‡¶æ‡¶á‡¶≤ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
      }
    }

    // --------------------------
    // RENDER AYAHs (based on mode)
    // --------------------------
    function renderAyahs() {
      ayahContainer.innerHTML = '';
      if (!state.surahData || !state.surahData.ayahs) return;

      const isTelawat = state.currentMode === 'telawat';

      state.surahData.ayahs.forEach(ayah => {
        const card = document.createElement('div');
        card.className = 'ayah-card';

        const header = document.createElement('div');
        header.className = 'ayah-header';

        const label = document.createElement('div');
        label.className = 'ayah-label';
        label.textContent = `‡¶Ü‡ßü‡¶æ‡¶§ ${ayah.ayahNumber}`;

        const badge = document.createElement('div');
        badge.className = 'ayah-number-circle';
        badge.textContent = ayah.ayahNumber;

        header.appendChild(label);
        header.appendChild(badge);
        card.appendChild(header);

        // Arabic line
        const arDiv = document.createElement('div');
        arDiv.className = 'ayah-ar-text';
        arDiv.textContent = ayah.arabic || '';
        card.appendChild(arDiv);

        // Bangla translation (always under Arabic line)
        const bnDiv = document.createElement('div');
        bnDiv.className = 'ayah-bn-text';
        bnDiv.textContent = ayah.bangla || '';
        card.appendChild(bnDiv);

        // Word behaviour according to mode
        if (isTelawat) {
          // TELAWAT MODE ‚Üí ‡¶ï‡ßã‡¶® Arabic word tap ‡¶ï‡¶∞‡¶≤‡ßá ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ bar
          if (ayah.words && Array.isArray(ayah.words)) {
            arDiv.style.cursor = 'pointer';
            arDiv.addEventListener('click', () => {
              // ‡¶™‡ßÅ‡¶∞‡ßã line click ‡¶ï‡¶∞‡¶≤‡ßá ‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶™‡ßç‡¶∞‡¶•‡¶Æ word ‡¶¶‡ßá‡¶ñ‡¶æ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶ø optionally
              const firstWord = ayah.words[0];
              if (firstWord) {
                openWordBar({
                  ayahNumber: ayah.ayahNumber,
                  arabicWord: firstWord.text,
                  meaningBn: firstWord.meaningBn,
                  notes: firstWord.notes,
                  fullArabic: ayah.arabic
                });
              }
            });

            // ‡¶ö‡¶æ‡¶á‡¶≤‡ßá ‡¶™‡ßç‡¶∞‡¶§‡¶ø word ‡¶Ü‡¶≤‡¶æ‡¶¶‡¶æ ‡¶ï‡¶∞‡ßá split ‡¶ï‡¶∞‡ßá clickable ‡¶ï‡¶∞‡¶§‡ßá‡¶ì ‡¶™‡¶æ‡¶∞‡¶ø future ‡¶è
          }
        } else {
          // WBW MODE
          if (ayah.words && Array.isArray(ayah.words)) {
            const grid = document.createElement('div');
            grid.className = 'wbw-grid';

            ayah.words.forEach(word => {
              const pill = document.createElement('div');
              pill.className = 'wbw-pill';

              const wAr = document.createElement('div');
              wAr.className = 'wbw-ar';
              wAr.textContent = word.text || '';

              const wBn = document.createElement('div');
              wBn.className = 'wbw-bn';
              wBn.textContent = word.meaningBn || '';

              pill.appendChild(wAr);
              pill.appendChild(wBn);

              pill.addEventListener('click', () => {
                openWordBar({
                  ayahNumber: ayah.ayahNumber,
                  arabicWord: word.text,
                  meaningBn: word.meaningBn,
                  notes: word.notes,
                  fullArabic: ayah.arabic
                });
              });

              grid.appendChild(pill);
            });

            card.appendChild(grid);
          }
        }

        ayahContainer.appendChild(card);
      });
    }

    // --------------------------
    // WORD BAR + GRAMMAR
    // --------------------------
    function openWordBar(context) {
      if (!context) return;
      state.lastWordContext = context;

      wordBar.style.display = 'block';
      wordBarAr.textContent = context.arabicWord || '';
      wordBarBn.textContent = context.meaningBn || '';

      // Grammar button availability
      if (context.notes && context.notes.trim()) {
        wordBarGrammarBtn.disabled = false;
        wordBarGrammarBtn.style.opacity = '1';
      } else {
        wordBarGrammarBtn.disabled = true;
        wordBarGrammarBtn.style.opacity = '0.5';
      }
    }

    function closeWordBar() {
      wordBar.style.display = 'none';
      state.lastWordContext = null;
    }

    wordBarGrammarBtn.addEventListener('click', () => {
      if (!state.lastWordContext || !state.lastWordContext.notes) return;
      const ctx = state.lastWordContext;

      grammarModalAyahLabel.textContent = `‡¶Ü‡ßü‡¶æ‡¶§ ${ctx.ayahNumber}`;
      grammarModalAr.textContent = ctx.arabicWord || '';
      grammarModalNotes.textContent = ctx.notes || '';

      grammarModalBackdrop.style.display = 'flex';
    });

    grammarModalClose.addEventListener('click', () => {
      grammarModalBackdrop.style.display = 'none';
    });

    grammarModalBackdrop.addEventListener('click', (e) => {
      if (e.target === grammarModalBackdrop) {
        grammarModalBackdrop.style.display = 'none';
      }
    });

    // Optionally, tap outside word bar to close (mobile friendly)
    wordBar.addEventListener('click', (e) => {
      // ‡¶∂‡ßÅ‡¶ß‡ßÅ bar ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá ‡¶¨‡¶®‡ßç‡¶ß ‡¶®‡¶æ ‚Äì future ‡¶è ‡¶ö‡¶æ‡¶á‡¶≤‡ßá gesture ‡¶¶‡¶ø‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶ø
    });

    // --------------------------
    // MODE TOGGLE
    // --------------------------
    modeToggleBtn.addEventListener('click', () => {
      if (state.currentMode === 'telawat') {
        state.currentMode = 'wbw';
        modeToggleBtn.dataset.mode = 'wbw';
        modeToggleBtn.classList.remove('primary');
        modeToggleBtn.classList.add('primary'); // ‡¶∞‡¶æ‡¶ñ‡¶≤‡¶æ‡¶Æ bright ‡¶∞‡¶æ‡¶ñ‡¶§‡ßá
        modeToggleBtn.innerHTML = `<span class="icon">üîç</span><span class="label">WBW</span>`;
      } else {
        state.currentMode = 'telawat';
        modeToggleBtn.dataset.mode = 'telawat';
        modeToggleBtn.classList.remove('primary');
        modeToggleBtn.classList.add('primary');
        modeToggleBtn.innerHTML = `<span class="icon">üìñ</span><span class="label">Telawat</span>`;
      }

      if (state.surahData) {
        renderAyahs();
      }
      closeWordBar();
    });

    // --------------------------
    // SETTINGS
    // --------------------------
    function openSettings() {
      settingsPanel.style.display = 'block';
    }

    function closeSettings() {
      settingsPanel.style.display = 'none';
    }

    settingsBtn.addEventListener('click', () => {
      if (settingsPanel.style.display === 'block') {
        closeSettings();
      } else {
        openSettings();
      }
    });

    settingsClose.addEventListener('click', closeSettings);

    document.addEventListener('click', (e) => {
      if (!settingsPanel.contains(e.target) && e.target !== settingsBtn) {
        // ‡¶¨‡¶æ‡¶á‡¶∞‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá settings panel ‡¶¨‡¶®‡ßç‡¶ß
        closeSettings();
      }
    });

    // Font slider handlers
    function updateFontVars() {
      document.documentElement.style.setProperty('--font-ar', arFontSlider.value);
      document.documentElement.style.setProperty('--font-bn', bnFontSlider.value);
      document.documentElement.style.setProperty('--font-notes', notesFontSlider.value);

      arFontValue.textContent = `${parseFloat(arFontSlider.value).toFixed(2)}rem`;
      bnFontValue.textContent = `${parseFloat(bnFontSlider.value).toFixed(2)}rem`;
      notesFontValue.textContent = `${parseFloat(notesFontSlider.value).toFixed(2)}rem`;
    }

    arFontSlider.addEventListener('input', updateFontVars);
    bnFontSlider.addEventListener('input', updateFontVars);
    notesFontSlider.addEventListener('input', updateFontVars);

    // --------------------------
    // INIT
    // --------------------------
    renderSurahList();
    updateFontVars();
  </script>
</body>
</html>
